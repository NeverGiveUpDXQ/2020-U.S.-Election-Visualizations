---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Results

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(GGally)
library(gridExtra)
library(here)
library(highcharter)
library(MASS)
library(parcoords)
library(plotly)
library(readr)
library(scales)
library(stringr)
library(tidyverse)
library(usdata)
library(statebins)
library(usmap)
library(dplyr)
library(plyr)
library(socviz)
library(ggrepel)
library(gridExtra)
library(ggthemes)
library(grid)
library(lubridate)
library(tidytext)
#library(devtools)
#devtools::install_github("lchiffon/wordcloud2")
library(wordcloud2)
library(jsonlite)
library(RColorBrewer)
```

## US Presidential Election

In the U.S., a presidential candidate needs to [receive a minimum of 270 out of 538 electoral votes to win the election](https://apnews.com/article/electoral-college-popular-vote-explained-f9ba69cbbe0493e0248603065790efad), therefore every state matters in determining the election results. Also, with a ["winner takes all" system](https://ballotpedia.org/Winner-take-all) implemented in all states except for Nebraska and Maine, popular votes are important since all the electoral votes of a state go to the candidate with the most popular votes. Based on the published voting results, we carried out extensive analysis on 2020 US Presidential Election to take a closer look at the popular votes received by two candidates on the state level. You can also go to [Fox News](https://www.foxnews.com/elections/2020/general-results) to see detailed electoral vote results.

### 2020 Election Margins by State

```{r}
president2020 <- readr::read_csv(here::here("./data/clean/president2020.csv"))

# Flipped states
flipped <- president2020[president2020$stateid %in% c('AZ', 'WI', 'MI', 'PA', 'GA'),]

# Select columns
president2020<- president2020%>%
  select(stateid,state,dem_this_margin)

colors = c("firebrick2","white","dodgerblue3")

# Highchart map
highchart() %>%
  hc_title(text = "2020 Election Result Margin By State") %>%
  hc_subtitle(text = "Double click on the state area to zoom in") %>%
  hc_add_series_map(usgeojson, president2020,
    name = "Margin",
    value = "dem_this_margin", joinBy = c("name", "state"),
    dataLabels = list(
       enabled = TRUE,
       format = "{point.properties.postalcode}"
     )
   ) %>%
   hc_legend(title = '2020 Margin')%>%
   hc_colorAxis(min = -0.5, max = 0.5,
                stops = color_stops(n=3, colors=colors)) %>%
   hc_mapNavigation(enabled = TRUE) %>%
   hc_legend(title = list(text = "Vote Share Margin of Dem."),
              enabled = TRUE) %>% 
  hc_exporting(enabled = TRUE)
```
The first map displayed Democrats' presidential margins, i.e. difference between Dem. vote shares and Rep. vote shares, in each state. We cut the margins by -0.5 and 0.5, but if zooming in to the Virginia-Maryland region, we can see Biden's margin in **D.C** was larger than 0.5 (equal to 86.75%). Besides winning a landslide victory in **D.C.**, Biden also won **Vermont**, **Massachusetts**, and **Maryland** with a margin larger than 30%, whereas Trump won **Wyoming**, **West Virginia**, **North Dakota**, and **Oklahoma** with absolute advantages. These states are clearly either blue or red, but there are also several states with a very narrow margin that are shown in the middle white color. Hot races took place in **Florida**, **North Carolina**, **Georgia**, **Arizona**, **Wisconsin**, **Pennsylvania**, **Nevada**, and **Michigan** where the margins of the winning party were less than 5%. 

In general, we can see Biden's advantage in the West Coast and the Northeast of the US while Trump's advantage in the Southwest and the Central America. In terms of the number of states won, Biden won 26 states and Trump won 25 states, but the number of electoral votes made a big difference in the final results. 

You can see more detailed vote share margins by county in the [interactive component chapter](https://nevergiveupdxq.github.io/2020-U.S.-Election-Visualizations/interactive-component.html)

Comparing election results between 2016 and 2020, we found:

- There were noticeable margin shifts in many states, which most of these states voted for Hillary Clinton in 2016 and futher expanded Democrat's margin in 2020. The margins in **Vermont** and **Colorado** shifted the most by 9% (26.41% Dem -> 35.40% Dem) and 8.6% (4.91% Dem -> 13.5% Dem) respectively. 
- Joe Biden enlarged the margins in a couple of battlegrounds that Hillary Clinton won in 2016: **Minnesoda** (1.52% Dem -> 7.11% Dem) and **New Hampshire** (0.37% Dem -> 7.35% Dem).
- Joe Biden flipped 5 states that Donald Trump won in 2016, which are displayed in the plot below. 

```{r}
# Highchart map: flipped states only
highchart() %>%
  hc_title(text = "2020 Election Result Margin: Filpped States") %>%
  hc_subtitle(text = "Double click on the state area to zoom in") %>%
  hc_add_series_map(usgeojson, president2020,
    name = "Margin",
    value = "dem_this_margin", joinBy = c("name", "state"),
    dataLabels = list(
       enabled = TRUE,
       format = "{point.properties.postalcode}"
     )
   ) %>%
  hc_add_series_map(usgeojson, flipped,
    name = "Margin",
    value = "dem_this_margin", joinBy = c("name", "state"),
    dataLabels = list(
       enabled = TRUE,
       format = "{point.properties.postalcode}"
     )
   ) %>%
   hc_colorAxis(min = min(flipped$dem_this_margin), max = max(flipped$dem_this_margin),
                minColor = 'powderblue', maxColor = 'blue') %>%
   hc_mapNavigation(enabled = TRUE) %>%
   hc_legend(title = list(text = "Vote Share Margin of Dem."),
              enabled = TRUE) %>% 
   hc_exporting(enabled = TRUE)
```

We filtered the five flipped states, and the changes in popular margins are: **Michigan** (0.23% Rep -> 2.78% Dem), **Pennsylvania** (0.72% Rep -> 1.16% Dem), **Wisconsin** (0.77% Rep -> 0.63% Dem), **Arizona** (3.55% Rep -> 0.31% Dem), and **Georgia** (5.13% Rep -> 0.24% Dem). Among them, Georgia had the most margin shift. 


### Historical Timeline

#### Trace Election Margin Shifts Over Years
We compared how vote shares have shifted in elections from 1976 to 2020
**Instructions to use the graph:**

1. Play/pause clicking the play/pause button
2. Play/pause by hitting space
3. Navigate the motion slider by dragging the slider thumb
4. Navigate the motion slider by hitting the left and right arrow keys
Please refer to [the wiki here](https://github.com/TorsteinHonsi/Motion-Highcharts-Plugin/wiki) for more information about motion highcharts.

```{r}
# help file: https://api.highcharts.com/highcharts/labels.items
# reference : RPubs: William Green(https://rpubs.com/wbgreen405/249838)

president2020_1 <- president2020 %>%
    mutate(year = 2020)%>%
    select(-stateid)%>%
    select(year,state,dem_this_margin)

history_election <- readr::read_csv(here::here("./data/clean/1976-2016election.csv"))

election_whole <- rbind(history_election,president2020_1)

election_ds = election_whole %>%
    group_by(state) %>%
    do(item = list(
        state = first(.$state),
        sequence = round(.$dem_this_margin,3),
        value = first(.$dem_this_margin)
    ))%>%
    .$item

highchart(type = "map") %>% 
  hc_add_series(data = election_ds,
                name = "Dem. Margin",
                mapData = usgeojson,
                joinBy = c("name","state"),
                borderWidth = 0.05,
                dataLabels = list(enabled = TRUE, format = "{point.properties.postalcode}")
                ) %>% 
  hc_colorAxis(stops = color_stops(n=3, colors=colors),
               min = -0.5,
               max = 0.5 ) %>%  
  hc_title(text = "Presidential Election Results Map from 1976 to 2020") %>%
  hc_legend(layout = "vertical", 
            align = "right",
            title = list(text = 'Margin')) %>% 
  hc_add_theme(hc_theme_smpl()) %>%
  hc_motion(
    enabled = TRUE,
    axisLabel = "year",
    labels = as.character(sort(unique(election_whole$year),decreasing = FALSE)),
    magnet = list(
      round = "floor" 
    )
  )%>% 
  hc_exporting(enabled = TRUE)
```

This motion map shows that initially the left half of the map was red and the right half was blue. From 1980 to 1988, red (Republicans) has dominated this map. Especially in 1984, almost all states were red (except for  Minnesota and note that Minnesota has always been blue from 1976 to 2020). Also, from 1992, the "red states" and "blue states" became more stable, and only a few were swing states.


However, pesidential candidates of the US winning more popular votes did not always win the election. *"It is possible the candidate with the most votes from the public won't be the winner. This is because the president is not chosen directly by the voters, but what's known as the electoral college."* (This is explained by [BBC](https://www.bbc.com/news/world-us-canada-53558176).) Thus, In this part, we compared popular vote shares vs. electoral college vote shares in US elections since 1900. 

```{r}
# Code reference: https://socviz.co/workgeoms.html#workgeoms
# HIGHLY recommended this book!! Really APPRECIATE:)

elections_historic_new <- readr::read_csv(here::here("./data/clean/elections_historic_new.csv"))
# Start plotting from year 1900
elections_historic_new<- elections_historic_new[-c(1:19),]
# plot
ggplot(elections_historic_new, aes(x = popular_pct, 
                                   y = ec_pct,
                                   label = winner_label))+
  geom_hline(yintercept = 0.5, size = 1.4, color = "gray80")+
  geom_vline(xintercept = 0.5, size = 1.4, color = "gray80")+
  geom_point(aes(colour = factor(win_party))) +
  geom_text_repel(size = 2) + # deal with overlapping labels
  scale_color_manual(values=c("dodgerblue3", "firebrick2")) + #manual colors
  scale_x_continuous(labels = scales::percent) +
  scale_y_continuous(labels = scales::percent) +
  annotate(geom = "rect", xmin = 0.4, xmax = 0.498, ymin = 0.502, ymax = 0.85, fill = "red", alpha = 0.2) + 
  annotate(geom = "text", x = 0.4, y = 0.9, label = "High electoral vote share\nbut low popular vote share", hjust = 0)+
  labs(x = "Winner's share of popular votes", 
       y = "Winner's share of electoral college votes", 
       title = "US Presidential Elections: Popular vs. Electoral College Shares", subtitle = "From 1900 to 2020",
       caption = "Source: socviz & Cook Political", colour = "Party affiliation of winner")+
  theme_bw() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"),
        axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position="bottom",
        legend.title = element_text(face="bold"))
```

Note: axes of the plot do not start from 0 as usual since we want to reduce point overlapping and zoom in to the area that contains all points of interest. 
From the plot above, we can see: 

- Each point in the plot represents a winner of the US Presidential Election and the axes show the popular and electoral vote shares of the winner in the respective election year. All points fall above the horizontal line y = 50% since every president-elect obtained more than half of the electoral votes to win the election.
- Ideally, we hope the president-elect also had high share of popular vote. However, the data points falling in the red rectangle were not this case. There were outliers in the plot, for example, in the years 1912 and 1992, Wilson and Clinton won the election of the time with high electoral vote shares, but their popular votes shares were lower than 45%. Trump in 2016 also won the election with more electoral votes but fewer popular votes.
- Additionally, we can see **Reagan** in 1984, **Roosevelt** in 1936, and **Nixon** in 1972 won the elections with overwhelming support that their shares in both electoral votes and popular votes were very high.

## Contribution Receipts Data


### Where Contributions Came from

#### Overview: Total Contributions by State
As an overview, we plotted the total amounts of contributions made by each state this year that were received by all presidential candidates of 2020 US election. 


## Contribution Receipts Data
### Contributions Overview

```{r, echo=FALSE}
# Read the datasets
  # Contribution summary by state
contrib_zip <- readr::read_csv(here::here("data", "clean", "Contributions_by_3Zip.csv"))

  # Population and registered Voters in 2020 by state
voters_state <- readr::read_csv(here::here("data", "clean", "RegisteredVotersByState.csv"))

# All candidates
df_all <- contrib_zip[contrib_zip$CANDIDATE_ID=="P00000001" & 
              contrib_zip$ZIP_3=="STATE TOTAL",] %>%
  dplyr::rename(ALL_RECEIPT_AMOUNT = CONTRIB_RECEIPT_AMOUNT)
	
# Biden = P80000722
df_biden <- contrib_zip[contrib_zip$CANDIDATE_ID=="P80000722" & 
              contrib_zip$ZIP_3=="STATE TOTAL",]%>%
  dplyr::rename(BIDEN_RECEIPT_AMOUNT = CONTRIB_RECEIPT_AMOUNT)
# Trump = P80001571
df_trump <- contrib_zip[contrib_zip$CANDIDATE_ID=="P80001571" & 
              contrib_zip$ZIP_3=="STATE TOTAL",] %>%
  dplyr::rename(TRUMP_RECEIPT_AMOUNT = CONTRIB_RECEIPT_AMOUNT)

# Join with state populations
data("statepop")
statepop1 <- statepop[,c(1:3)] %>%
  left_join(voters_state[,c(1:4)],by = c("full" = "State" )) %>%
  left_join(df_all[,c(3,6)], by = c("abbr" = "CONTRIB_STATE")) %>%
  left_join(df_biden[,c(3,6)], by = c("abbr" = "CONTRIB_STATE")) %>%
  left_join(df_trump[,c(3,6)], by = c("abbr" = "CONTRIB_STATE")) 


# Calculate contribution amounts per registered voter of each state
statepop1 <- statepop1 %>%
  mutate(ALL_CONTRIB_PP = round(ALL_RECEIPT_AMOUNT/totalRegistered, 2))%>%
  mutate(BIDEN_CONTRIB_PP = round(BIDEN_RECEIPT_AMOUNT/totalRegistered, 2))%>%
  mutate(TRUMP_CONTRIB_PP = round(TRUMP_RECEIPT_AMOUNT/totalRegistered, 2))

#remove(voters_state, statepop, df_trump, df_biden, df_all)
```


#### Total Contributions by State
As an overview, we plotted the total amounts of contributions made by each state this year that were received by all presidential candidates of 2020 US election. 

```{r, echo=FALSE}
# Define highcharter theme
thm <- hc_theme(
  chart = list(
        backgroundColor = "white", 
        style = list(fontFamily = "Montserrat")),
  title = list(style = list(color ='#333333',
                            fontWeight = "bold",
                            fontFamily = "Arial")),
  subtitle = list(style = list(color ='#666666',
                               fontSize = "14px",
                               fontFamily = "Arial")),
  legend = list(itemStyle = list(fontFamily = "Arial",color ='black'), 
                itemHoverStyle = list(color ='gray')))



# All states
data("usgeojson", package = "highcharter")
highchart() %>%
hc_title(text = "Total Contributions to All Presidential Candidates 2020 By State") %>%
  hc_subtitle(text = "Double click on the state area to zoom in") %>%
  hc_add_series_map(usgeojson, statepop1,
    name = "Total Contributions",
    value = "ALL_RECEIPT_AMOUNT", joinBy = c("postalcode", "abbr"),
    dataLabels = list(
       enabled = TRUE,
       format = "{point.properties.postalcode}"
     ),
    tooltip = list(
      valueDecimals = 0,
      valuePrefix = "$",
      valueSuffix = " USD"
     )
   ) %>%
   hc_colorAxis(minColor = "white", maxColor = "orange") %>%

   hc_legend(title = list(text = "US Dollar Amount"), valueDecimals = 0, valueSuffix = "%") %>%
   hc_mapNavigation(enabled = TRUE) %>%
  hc_exporting(enabled = TRUE)
```

As shown in the map above, **California** has contributed the most to all presidential candidates in 2020 US Election, which exceeded 260 million US dollars. Contributions from **New York**, **Texas**, and **Florida** were also significant. On the other hand, **North Dakota**, **South Dakota**, and **Wyoming** have made the least contributions to all presidential candidates, probably because of their small populations.

#### Biden vs. Trump: Contributions by State
```{r,echo=FALSE}
d1 <- statepop1 %>% arrange(desc(BIDEN_RECEIPT_AMOUNT))%>% 
  select(abbr, BIDEN_RECEIPT_AMOUNT,TRUMP_RECEIPT_AMOUNT) %>%
  pivot_longer(!abbr, names_to = "Candidate", values_to = "Contribution")
d1$Candidate <- as.factor(d1$Candidate)
d1$Candidate <- fct_recode(d1$Candidate,TRUMP = "TRUMP_RECEIPT_AMOUNT",BIDEN = "BIDEN_RECEIPT_AMOUNT")
d1 %>%
  hchart('column', hcaes(x = 'abbr', y = 'Contribution', group = 'Candidate'),
    stacking = "normal") %>%
  hc_colors(c("#0015BC", "#FF0000"))%>%
  hc_chart(zoomType = "x") %>%
  hc_legend(align = "right", verticalAlign = "top",layout = "horizontal",floating=TRUE,y=80,x=-100) %>%
  hc_xAxis(title = list(text = "State"),
           labels= list(style=list(fontSize='10px'),
                        rotation = -45, step = 1)) %>%
  hc_yAxis(title = list(text = "Contribution Amount (US Dollars)")) %>%
  hc_title(text = "<b>Contributions to Biden vs. Trump 2020 by State</b>") %>%
  hc_subtitle(text = "Click on the legend to show selected candidates; click on a state and drag across to zoom in.") %>%
  hc_exporting(enabled = TRUE)
```

The bar chart above displays how much Joe Biden and Donald Trump have raised in each state in 2020, and it is sorted by the amounts of Joe Biden's raisings. You can zoom in to see each state's contribution amounts in detail. Joe Biden received solid support from **California** and **New York** which contributed 127M dollars and 63M dollars respectively, more than twice as contributed to Donald Trump. Besides receiving 58M dollars from **California**, Donald Trump also raised significant amounts from **Texas** and **Florida** equal to 52M and 48M dollars respectively, much more than Biden. We found that these are consistent with the final voting results as Biden has won California and New York with a margin larger than 20% whereas Trump won Florida and Texas, two of the battleground states.

#### Biden vs. Trump: Contributions Per Registered Voter by State
```{r, echo=FALSE, fig.width=10}
# Biden
p3<- statepop1 %>% arrange(desc(BIDEN_CONTRIB_PP)) %>% head(5) %>% 
  ggplot(aes(x=reorder(abbr, BIDEN_CONTRIB_PP, median), y=BIDEN_CONTRIB_PP)) +
    geom_bar(stat="identity", fill="dodgerblue3") +
    geom_text(aes(label=BIDEN_CONTRIB_PP), hjust=1.2, color="white", size=3.5) +
    coord_flip() +
    # formatting
    ggtitle("Joe Biden") +
    labs(y = "Contribution Amount (US Dollar)", x = "State",caption = " ") +
    theme_minimal() +
    theme(plot.title = element_text(size = 11,face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"))

# Trump
p4<- statepop1 %>% arrange(desc(TRUMP_CONTRIB_PP)) %>% head(5) %>% 
  ggplot(aes(x=reorder(abbr, TRUMP_CONTRIB_PP, median), y=TRUMP_CONTRIB_PP)) +
    geom_bar(stat="identity", fill="firebrick2") +
    geom_text(aes(label=TRUMP_CONTRIB_PP), hjust=1.2, color="white", size=3.5) +
    coord_flip() +
    # formatting
    ggtitle("Donald Trump") +
    labs(y = "Contribution Amount (US Dollar)", x = " ",caption = "Source: fec.gov") +
    theme_minimal() +
    theme(plot.title = element_text(size = 11, face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"))

p5<- statepop1 %>% arrange(desc(TRUMP_CONTRIB_PP)) %>% head(5) %>% 
  ggplot(aes(x=reorder(abbr, TRUMP_CONTRIB_PP, median), y=TRUMP_CONTRIB_PP)) +
    geom_bar(stat="identity", fill="firebrick2") +
    geom_text(aes(label=TRUMP_CONTRIB_PP), hjust=1, color="white", size=3.5) +
    scale_y_continuous(limits = c(0, 37)) +
    coord_flip() +
    # formatting
    ggtitle("Donald Trump") +
    labs(y = "Contribution Amount (US Dollar)", x = " ",caption = "Source: fec.gov") +
    theme_minimal() +
    theme(plot.title = element_text(size = 11, face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"))


# Plot in a grid
#grid.arrange(p3, p4, ncol=2, nrow=1,
#     top = textGrob("Contributions to Presidential Candidates of 2020 US #Election\nContributions Per Registered Voter Ranked by #State",gp=gpar(fontsize=13, fontface = "bold")))

grid.arrange(p3, p5, ncol=2, nrow=1,
     top = textGrob("Contributions to Presidential Candidates of 2020 US Election\nContributions Per Registered Voter Ranked by State",gp=gpar(fontsize=13, fontface = "bold")))

grid.arrange(p3, p5, ncol=2, nrow=1,
     top = textGrob("Contributions to Presidential Candidates of 2020 US Election\nContributions Per Registered Voter Ranked by State",gp=gpar(fontsize=13, fontface = "bold")))

```


If we instead take into account the [**registered voters**](https://worldpopulationreview.com/state-rankings/number-of-registered-voters-by-state) in each state and calculate contributions per registered voter, we can see **District of Columbia** is clearly an outlier. It has the highest average contribution to Biden equal to 37 dollars per registered voter, way more than any other state. Remarkably, in the election Biden won **93%** of total votes in DC. In addition, **Wyoming** surprisingly has contributed the most to Trump on an average level. After researching online, we found that Wyoming has the lowest percentage of registered voters among all states that only [47.4% of its population registered to vote](https://worldpopulationreview.com/state-rankings/number-of-registered-voters-by-state), and this explains Wyoming's higher average contribution. Its support for Trump was reflected on the voting results that Trump won the state with a margin **over 40%**.
In fact, Biden has won all five states (**DC, MA, DE, CA, and MD**) listed on the left of the plot above which has made the most contributions per registered voter, and his margins of victory in these states were . Trump has won four of the five states (**WY, FL, AZ, and TX**) listed on the right of the plot above except for Nevada. Trump lost Nevada by 2.4% vote share.



### Individual Contribution Distribution
```{r, echo=FALSE}
# Read data
contributions1 <- readr::read_csv(here::here("data", "clean", "contribution_processed.csv"))

#head(contributions1)

#summary(contributions1)

# Factorize categorical variables
contributions1$committee_name <- as.factor(contributions1$committee_name)
```
```{r, message=FALSE, warning=FALSE, echo = FALSE, results = "asis"}
# Calculate the summary statistics of contributions by candidate
contr_sum <- contributions1 %>%
  select(committee_name,contribution_receipt_amount) %>%
  dplyr::group_by(committee_name) %>% 
  dplyr::summarise(number_of_contributions = n(),
            total_raised_amount = round(sum(contribution_receipt_amount)/1000000,1),
            mean_contribution = mean(contribution_receipt_amount, na.rm = T),
            median_contribution = median(contribution_receipt_amount, na.rm = T))

# Display in a table
knitr::kable(contr_sum, caption = "Individual Contributions Summary by Candidate",
             col.names = c('Candidate name','Number of contributions',
                           'Total raised amount (Million US Dollars)',
                           'Mean contribution (US Dollars)','Median contribution (US Dollars)'),
             format.args = list(big.mark = ",", scientific = FALSE),
             digits = 2,align = "l",full_width = T)
```

```{r, fig.cap="Domestic Individual Contribution Distribution",echo=FALSE}
# Generate the boxplot
ggplot(contributions1, aes(x=contribution_receipt_amount, fill = committee_name), alpha=0.8) + 
  geom_boxplot() + 
  stat_boxplot(geom ='errorbar') +
  scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x),
              labels = trans_format("log10", math_format(10^.x)))+
  scale_fill_manual(name = "Candidate name", values = c("dodgerblue3", "firebrick2"), 
                    labels = c("Joe Biden","Donald Trump")) +
  # formatting
  ggtitle("Contributions to Presidential Candidates of 2020 US Election",
          subtitle = "Domestic Individual Contribution Amounts Received in 2020 (log10 scaled)") +
  labs(y = "Candidate", x = "Contribution Amount ($)",caption = "Source: fec.gov") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"),
        legend.position="bottom",
        axis.text.y = element_blank())

```

To see more contribution details, we selected from the original data the **domestic individual contributions with amounts higher than 200 dollars** received by two presidential candidates. As shown in the contributions summary table, Biden received double the number of contributions and the total amounts of funds as Trump did, but the mean and median contributions to Trump are higher than to Biden. The log10 scaled boxplot above also demonstrates the difference in median contributions, and in addition, it shows that the contributions distributions for both candidates are largely right skewed with a good number of outliers. This makes sense as the majority of individuals contributed less than 500 dollars. 


### When Contributions Were Made
```{r, echo=FALSE}
# Read the dataset
contribution_by_date <- readr::read_csv(here::here("data", "clean", "contribution_by_date.csv"))

# Convert format
contribution_by_date$contribution_receipt_date <-
  as_date(contribution_by_date$contribution_receipt_date)
contribution_by_date$committee_name <-
  as.factor(contribution_by_date$committee_name)

ts <- contribution_by_date[order(contribution_by_date$contribution_receipt_date, 
                                 decreasing= F),]

# Interactive time series plot with highcharter
ts1 <- ts %>%
  hchart("line",hcaes(x = contribution_receipt_date, y = Total, 
                      group = committee_name)) %>%
  hc_chart(zoomType = "x") %>%
  hc_colors(c("#0015BC", "#FF0000")) %>%
  hc_legend(align = "center", verticalAlign = "bottom",layout = "horizontal") %>%
  hc_xAxis(title = list(text = "Contribution Receipt Date"),
           labels = list(format = '{value:%b %d}')) %>%
  hc_yAxis(title = list(text = "Contribution Amount (US Dollars)"),
           tickInterval = 2000000,
           max = 14000000) %>%
  hc_title(text = "<b>Individual Contributions to US Presidential Candidates 2020 by Date</b>") %>%
  hc_subtitle(text = "Click and drag in the plot area to zoom in on a time span") %>%
  hc_plotOptions(area = list(lineWidth = 0.5)) %>% 
  hc_exporting(enabled = TRUE)


ts1 %>%
  hc_add_annotation(
    labelOptions = list(
      backgroundColor = 'rgba(0,0,0,0.4)',
      verticalAlign = 'top',
      y = 15
    ),
    labels = list(
      list(point = list(xAxis = 0, yAxis = 0,
          x = datetime_to_timestamp(as.Date("2020/02/29")),
          y = 2200000), text = "Feb.29 - Biden Won South Carolina Primary"),
      list(point = list(xAxis = 0, yAxis = 0,
          x = datetime_to_timestamp(as.Date("2020/03/04")),
          y = 3700000), text = "Mar.4 - Michael Bloomberg dropped out and endorsed Biden"),
      list(point = list(xAxis = 0, yAxis = 0,
          x = datetime_to_timestamp(as.Date("2020/08/11")),
          y = 6900000), text = "Aug.11 - Biden names Kamala Harris as VP nominee"),
      list(point = list(xAxis = 0, yAxis = 0,
          x = datetime_to_timestamp(as.Date("2020/08/20")),
          y = 13500000), text = "Aug.20 - Biden Accepted Democratic Nomination"),
      list(point = list(xAxis = 0, yAxis = 0,
          x = datetime_to_timestamp(as.Date("2020/08/27")),
          y = 4860000), text = "Aug.27 - Trump Accepted Republican Nomination"),
      list(point = list(xAxis = 0, yAxis = 0,
          x = datetime_to_timestamp(as.Date("2020/09/29")),
          y = 11500000), text = "Sep.29 - First Presidential Debate")
      )
    )
```

We also grouped data points by receipt date and calculated the daily raisings of each candidate from January 1, 2020 to October 15, 2020, which are shown as the plot above. It is clear that Joe Biden generally raised more funds than Donald Trump. We marked on the plot the major events when there were peaks in raisings of both candidates. A small peak of Biden's raisings in the early March was prominent, and this paralleled [Biden's win in the South Carolina Democratic presidential primary](https://edition.cnn.com/2020/03/01/politics/joe-biden-south-carolina-fundraising-february-cnntv/index.html) along with [Michael Bloomberg's quit](https://www.latimes.com/politics/story/2020-03-04/michael-bloomberg-quits-presidential-race), which we learned from the news of the time.
More notably, Biden achieved greater success in fundraising from mid-August, and Biden's daily raisings hit the 13.6M dollars on **August 20, 2020** by the time he [officially accepted the Democratic nomination](https://www.nytimes.com/2020/08/20/us/politics/Joe-Biden-accepts-democratic-nomination.html). On **September 30**, the next day of the first Presidential Debate, Joe Biden secured another huge funding of 12.2M dollars, which to some extent reflected people's choice. 
Although Donald Trump also received more funds in the second half year, the contributions to Trump did not significantly increase as the election season approached. Trump's peak in daily raisings of 4.9M dollars was reached on **August 27, 2020** when he [officially accepted the Republican nomination](https://www.usatoday.com/story/news/politics/elections/2020/08/27/rnc-donald-trump-republican-nomination-white-house-biden/5652490002/), but the amount was much less than that raised by Biden.   



### Who Contributors Were

To obtain a better understanding about individual contributors, we extracted keywords from contributors occupations and separated them by candidate, so that we were able to draw a word cloud for each candidate.


```{r,echo=FALSE}
# To save time, read the saved .csv datasets
oc_biden_count <- readr::read_csv(here::here("data", "clean", "occupation_BIDEN_count.csv"))

oc_trump_count <- readr::read_csv(here::here("data", "clean", "occupation_TRUMP_count.csv"))

  
# Wordcloud Biden
# Reference: https://www.r-graph-gallery.com/196-the-wordcloud2-library.html
pal_blue <- c("blue","#1F45FC","#2B60DE","#0000A0","#6698FF","#1589FF") #blue color palette
df_biden <- oc_biden_count
df_biden$freq <- (df_biden$freq)^(1/3) #scale the frequencies
```

#### **50 most popular contributor occupations: Joe Biden vs. Donald Trump: **
```{r, echo=FALSE, message=FALSE, warning=FALSE, results="asis"}
w1<- wordcloud2(df_biden, size = 0.4,
         maxRotation = 0, minRotation = 0,
         color=rep_len(pal_blue, nrow(df_biden)))
#library(htmlwidgets)
#library(webshot)
#saveWidget(w1,"w1.html",selfcontained = F)
#knitr::include_graphics("./w1.PNG")
```
```{r, echo=FALSE, message=FALSE, warning=FALSE, results="asis"}
# Wordcloud Trump
pal_red <- c("red","#F70D1A","#E77471","#F62217","#9F000F","#F75D59") #red color palette
df_trump <- oc_trump_count
df_trump$freq <- (df_trump$freq)^(1/3) #scale the frequencies

w2<- wordcloud2(df_trump, size = 0.4,
         maxRotation = 0, minRotation = 0,
         color=rep_len(pal_red, nrow(df_trump)))
#saveWidget(w2,"w2.html",selfcontained = F)
#knitr::include_graphics("./w2.PNG")
```

![](https://raw.githubusercontent.com/NeverGiveUpDXQ/2020-U.S.-Election-Visualizations/main/_bookdown_files/finalproj_files/figure-html/w1.PNG){width=45%} ![](https://raw.githubusercontent.com/NeverGiveUpDXQ/2020-U.S.-Election-Visualizations/main/_bookdown_files/finalproj_files/figure-html/w2.PNG){width=45%}

To display words properly, the size of words in word clouds was scaled by extracting a cube root of the word frequency count. The blue word cloud on the left for Joe Biden clearly showed that a great proportion of contributors were **not employed**, and **attorney**, **physician**, **engineer**, and **manager** were also popular occupations. 
In contrast, the red one on the left for Trump displayed the word **retired** most prominently, which implied that contributors who have supported Trump were dominantly retired. Besides, **entrepreneur**, **owner**, and **manager** were popular occupations. 
We chose word clouds to provide an overview of all popular job titles, but since it is harder to judge the size of texts, we generated a bar chart below that enables better comparison between the actual frequency counts.

```{r, fig.height=5, echo=FALSE}
# Bar charts of contributor occupations

# Biden
g1<- oc_biden_count %>% head(10) %>% 
  ggplot(aes(x=reorder(oc_str_sp, freq, median), y=freq)) +
    geom_bar(stat="identity", fill="dodgerblue3") +
    geom_text(aes(label=freq), hjust=-0.05, size=3) +
    coord_flip() +
    ylim(0, 220000) +
    # formatting
    ggtitle("Joe Biden") +
    labs(y = "Frequency", x = "Contributor occupation",caption = " ") +
    theme_minimal() +
    theme(plot.title = element_text(size = 11, face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"))

# Trump
g2<- oc_trump_count %>% head(10) %>% 
  ggplot(aes(x=reorder(oc_str_sp, freq, median), y=freq)) +
    geom_bar(stat="identity", fill="firebrick2") +
    geom_text(aes(label=freq), hjust=-0.05, size=3) +
    coord_flip() +
    ylim(0, 155000) +
    # formatting
    ggtitle("Donald Trump") +
    labs(y = "Frequency", x = " ",caption = "Source: fec.gov") +
    theme_minimal() +
    theme(plot.title = element_text(size = 11, face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"))


# Plot in a grid
grid.arrange(g1, g2, ncol=2, nrow=1,
     top = textGrob("Contributions to Presidential Candidates of 2020 US Election\nContributor Occupation Distribution",gp=gpar(fontsize=13, fontface = "bold")))

```

Comparing the difference between two candidates, more than half of 10 top occupations of Joe Biden's contributors are **legal or technical professional positions**, whereas more than half of 10 top occupations of Donald Trump's contributors are **positions in business**. 


## Disbursement Data Analysis
### Who Spent the Most
```{r, message=FALSE, warning=FALSE}
exp_df <- readr::read_csv(here::here("data", "clean", "disbursement_processed.csv"))
exp_df$disbursement_date <- as.Date(exp_df$disbursement_date, format="%Y-%m-%d %H:%M:%S")
```

```{r, message=FALSE, warning=FALSE}
# Calculate the total disbursement amount by committee (in million)
# Get the top 5 committee
com_exp <- exp_df %>%
  dplyr::group_by(committee_name) %>% 
  dplyr::summarise(total = round((sum(disbursement_amount) / 1e6), 2)) %>%
  arrange(desc(total)) %>% 
  slice(1:5) %>%
  ungroup()

# Find the corresponding Political Party for the committee
com_exp$PoliticalParty <- c('D', 'D', 'R', 'D', 'D')

# Factorize the Political Party Column
com_exp$PoliticalParty <- factor(com_exp$PoliticalParty, 
                              levels=c("D", "R"), 
                              labels=c("Democratic", "Republican"))

# Store the top 5 Committee and their party into a variable
top5_pp <- com_exp %>% select(c("committee_name", "PoliticalParty"))

# Generate the Interactive Cleveland Dot Plot
ggplot(com_exp, aes(x = total, y = reorder(committee_name, total), color=PoliticalParty, label=total)) +
  geom_point() + 
  geom_text(hjust=-0.2, size = 3) +
  scale_x_continuous(limits=c(1,1000)) +
  scale_color_manual(name = "Political Party", values = c("dodgerblue3", "firebrick2"), 
                    labels = c("Democratic","Republican")) +
  scale_y_discrete(labels=c('Bernie Sanders', 'Tom Steyer', 'Donald Trump', 'Joe Biden', 'Mike Bloomberg')) +
  labs(x = "Total Expenditure (Million $)", y = "Candidate", caption = "Source: fec.gov", 
       title ="5 Presidential Campaigns Made the Most Disbursements", 
       subtitle = "2020 Presidential Election (Rounded to 2 Digits)") + 
  theme_bw() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"),
        legend.position="bottom")
```

Among 5 committees that spent the most during this year, 4 of them are Democratics, and only Donald Trump is Republican. This might relate to facts that the Democratic party has received more contributions than the Republican party, and also that there was little competition inside the Republican party as Trump ran for re-election. One interesting finding is that Mike Bloomberg's Committee spend the most among all of the committees, and this is not expected since Bloomberg quit the election race very early in March 2020. According to the article from [The Guardian](https://www.theguardian.com/us-news/2019/nov/23/michael-bloomberg-refuse-donations-presidential-bid), all of those expenditures came from Bloomberg's personal fortune instead of campaign contributions. Therefore, we treated Mike Bloomberg's campaign as an outlier. Joe Biden's committee and Donald Trump's committee were as expected the next most-spending campaigns, but Biden has spent 300 Million dollars more than Trump.


### What They Spent Money for

```{r, message=FALSE, warning=FALSE, fig.width=10, fig.height=8}
exp_perc <- exp_df %>% 
  filter(exp_df$committee_name %in% com_exp$committee_name & exp_df$disbursement_purpose_category != "REFUNDS") 
exp_perc$disbursement_purpose_category[exp_perc$disbursement_purpose_category %in% c("LOAN-REPAYMENTS","BANKING","TRANSFERS","CONTRIBUTIONS")] <- "OTHER"
exp_perc$disbursement_purpose_category[exp_perc$disbursement_purpose_category %in% c("FUNDRAISING","EVENTS","TRAVEL")] <- "FUNDRAISING/EVENTS/TRAVEL"

exp_1 <- exp_perc %>% 
  dplyr::group_by(committee_name, disbursement_purpose_category) %>% 
  dplyr::summarise(total = sum(disbursement_amount)) %>%
  mutate(Freq = 100 * total / sum(total))

# order categories
exp_1$disbursement_purpose_category <- as.factor(exp_1$disbursement_purpose_category)
exp_1$disbursement_purpose_category <- fct_reorder(exp_1$disbursement_purpose_category, exp_1$Freq, min)
# set colors
COLORS <- RColorBrewer::brewer.pal(6, "Set2")

exp_1%>%
  hchart('column', hcaes(x = 'committee_name', y = 'total', group = 'disbursement_purpose_category'),stacking="percent") %>%
  hc_colors(COLORS)%>%
  hc_chart(zoomType = "x") %>%
  hc_legend(title = list(text = "Disbursement Purpose",style=list(fontSize='14px')),
            align = "right", verticalAlign = "middle",layout = "vertical",floating=FALSE) %>%
  hc_xAxis(title = list(text = "Committee Name"),
           labels= list(style=list(fontSize='10px'),
                        rotation = -10, step = 1)) %>%
  hc_yAxis(title = list(text = "Percent of Total Expenditures (%)")) %>%
  hc_title(text = "<b>2020 Presidential Election Disbursement Break Down</b>") %>%
  hc_subtitle(text = "Click on the legend to show selected spending categories") %>%
  hc_tooltip(formatter= JS("function () { 
      return this.point.committee_name  + ' <br />' + 
      this.series.name  + ': '+ Math.round(this.point.total/10000)/100 + ' M dollars';}")) %>%
  hc_exporting(enabled = TRUE)
```
The stacked bar chart above shows the percentage of total disbursements spent on each category for the 5 most-spending campaigns. Committees spent the most on **Advertising**, while other expendituress were relatively trivial. Under the COVID-19 pandemics, candidates seemed to spend more on virtual services and canvass voters with mass public advertising rather than making campaign trips. As a result, disbursements in **Travel/Events/Materials** were particularly low. 
Also, we can see their spending strategy from the plot. Among the five candidates, Biden has spent the most, both in the proportion of total expenditures and in the dollar amount, in Advertising. On the other hand, Trump's and Bernie's election campaigns paid more for publicity items relative to other candidates that they prepared and purchased more campaign materials such as flyers, postcards, and pens for traditional campaign trips. 


```{r, message=FALSE, warning=FALSE, fig.width=15, fig.height=10}
# Calculate the total disbursement received by recipients
recipients_df <- exp_df %>% 
  dplyr::group_by(disbursement_purpose_category, recipient_name) %>% 
  dplyr::summarise(value = sum(disbursement_amount)) %>%
  arrange(disbursement_purpose_category, desc(value))
recipients_df <- filter(recipients_df, value > 0)

# select top 10 recipients among each disbursement category
top10_recipients <- recipients_df %>% 
  arrange(disbursement_purpose_category, desc(value)) %>% 
  dplyr::group_by(disbursement_purpose_category) %>% 
  slice(1:10)


# Graph Treemap based on the top 10 recipients among each category
dout <- data_to_hierarchical(data = top10_recipients, 
           group_vars=c("disbursement_purpose_category","recipient_name"),
           size_var = "value") 
hchart(dout, type="treemap", allowTraversingTree=TRUE) %>%
  hc_title(text = "<b>Major Disbursement Recipients in Each Category</b>") %>%
  hc_tooltip(pointFormat = "<b>{point.name}</b>:<br>
                            Total (US Dollar): {point.value:,.0f}") %>% 
  hc_exporting(enabled = TRUE)
```
Instructions to use this treemap:

- Hover over a color to see spendings on a category.
- Hover over a tag to see full recipient name.
- Click on a color to select a spending category.
Note: We tried to display the full names of companies, but many squares are small that we were not able to show names properly. However, you can move the mouse over a tag to read the full company name.

Going further from what we have discovered, we created the treemap above to find which companies were the top recipients and what services they have provided. As discussed before, advertising expenses were the largest expenditures for all candidates, and media agencies like **Media Assembly** and **Media Buying & Analytics.LLC** were major media buying service providers for candidates of the 2020 election. As expected, **Google** and **Facebook** were also among the top recipients as candidates largely leverage search engines and social media. There were also disbursements for administrative and consulting purposes. For example, **Zenefits**, **Vensure HR.LLC**, and **ADP.LLC** provide Human Resource supports like H.R. Management software systems. Presidential election committees also purchased consulting, financing, and other services to run the election, and you can click on the plot to see more details. 

### Biden vs. Trump: Disbursement Distribution
Focusing on the two final presidential candidates of 2020 US Election, we took a close look at their expenditure details. 
```{r}
# Display in a table
disbursement_summary <- disbursement_sum %>%
  select(committee_name, disbursement_amount) %>%
  dplyr::group_by(committee_name) %>% 
  dplyr::summarise(number_of_records = n(),
            total_disbursed_amount = round(sum(disbursement_amount)/1000000,1),
            mean_disbursement = mean(disbursement_amount, na.rm = T),
            median_disbursement = median(disbursement_amount, na.rm = T))

knitr::kable(disbursement_summary, caption = "Disbursement Summary by Candidate",
             col.names = c('Committee name','Number of Records',
                           'Total spending amount (Million US Dollars)',
                           'Mean spending amount (US Dollars)',
			   'Median spending amount (US Dollars)'),
             format.args = list(big.mark = ",", scientific = FALSE),
             digits = 2,align = "l",full_width = T)
```
```{r, message=FALSE, warning=FALSE}
# Calculate the total disbursement by committee
disbursement_sum <- exp_df %>% 
  filter(committee_name == 'BIDEN FOR PRESIDENT' | committee_name == 'DONALD J. TRUMP FOR PRESIDENT, INC.') %>% 
  filter(disbursement_amount > 0)
  
# Generate the boxplot
ggplot(disbursement_sum, aes(x=disbursement_amount, y= committee_name, fill=committee_name), alpha=0.8) + 
  geom_boxplot(varwidth = TRUE) + 
  stat_boxplot(geom ='errorbar') + 
  scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x),
              labels = trans_format("log10", math_format(10^.x)))+
  scale_fill_manual(name = "Candidate name", values = c("dodgerblue3", "firebrick2"), 
                    labels = c("Joe Biden","Donald Trump")) +
  labs(y = "Candidate", x = "Disbursement Amount (USD)",caption = "Source: fec.gov", 
       title="Disbursement Made by Presidential Committees of 2020 US Election",
       subtitle = "in US Dollar (log10 scaled)") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"),
        legend.position="bottom",
        axis.text.y = element_blank())
```

From the table above, it is clear that Biden spent 300 million dollars more than Trump. In the boxplot, we used the log10 scaled x-axis to reduce skewness of the disbursement distribution, but there are still many outliers on the right tail. Also, there are single expenditure records for both candidates with an amount larger than 10 million dollars. The median expemditures were similar for two candidates.


### Biden vs. Trump: When they spent the most
#### Spending Trend of Two Committees
```{r, message=FALSE, warning=FALSE}
biden_Trend <- exp_df %>% 
  filter(committee_name == "BIDEN FOR PRESIDENT" & disbursement_amount > 0)
biden_Trend <- aggregate(biden_Trend$disbursement_amount,
                         by=list(lubridate::floor_date((biden_Trend$disbursement_date), "week")), 
                         sum)
biden_Trend$x <- 100 * biden_Trend$x / sum(biden_Trend$x)
biden_Trend$Committee <- "BIDEN FOR PRESIDENT"

trump_Trend <- exp_df %>% 
  filter(committee_name == "DONALD J. TRUMP FOR PRESIDENT, INC." & disbursement_amount > 0)

trump_Trend <- aggregate(trump_Trend$disbursement_amount,
                         by=list(lubridate::floor_date((trump_Trend$disbursement_date), "week")), 
                         sum)

trump_Trend$x <- 100 * trump_Trend$x / sum(trump_Trend$x)
trump_Trend$Committee <- "DONALD J. TRUMP FOR PRESIDENT, INC."

ggplot(rbind(biden_Trend, trump_Trend),
       aes(x=Group.1, y=x, color=Committee)) +
  geom_point() + 
  geom_line() + 
  geom_line(stat = "smooth", method = "loess", alpha = 0.5) + 
  scale_x_date(labels = date_format("%m-%d"), 
               limits = c(min=as.Date("2020-01-01"), max=as.Date("2020-11-04")), 
               breaks = date_breaks("2 week")) + 
  scale_y_continuous(limits=c(0,15)) +
  scale_color_manual(values=c("dodgerblue3", "firebrick2")) + 
  labs(x = "Date", y = "Percent of Committee's Disbursements", caption = "Source: fec.gov", 
       title = "2020 Presidential Election Committees Weekly Expenditure Trend",
       subtitle = "Expenditures as Percents of Total Disbursements Made This Year") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"),
        axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position="bottom")
```

The time series plot shows weekly spending as a percentage of total disbursements made by the two presidential committees in 2020. It is clear that both committees spent more as the election day approached. Trump election committee started in late April to invest money in campaign activities, whereas Biden did not seem to start until late May, 2020. There were some peaks in Trump's committee spendings in early May, late June to early July, and early September to early October. Those corresponds to the cost of launching the Trump election game app, releasing digital ads to praise his policy on COVID-19 and attack Biden's statements respectively (information source: [ballotpedia.org](https://ballotpedia.org/Joe_Biden_presidential_campaign,_2020#Ballotpedia.27s_Daily_Presidential_News_Briefing)) On the other hand, major disbursements of Biden election committee came later but grew more rapidly. The first peak in the blue trend line appears in late February to early March. According to the presidential committee activity timeline provided by ballotpedia.org, that corresponds to Biden's first largest $12 million ad buy. Another peak of Biden's spending trend line was in late September to early October, which the expenditures of the week took more than 13% of total disbursements this year. Comparing to Trump, Biden's committee seeme to become more active as the election day approaches.

### Biden vs. Trump: Disbursements by State

```{r, message=FALSE, warning=FALSE,fig.width=20, fig.height=6}
# Disbursement Flow for Joe Biden's Main Committee
target_exp <- exp_df  %>%
  filter((committee_name == "BIDEN FOR PRESIDENT" | committee_name == "DONALD J. TRUMP FOR PRESIDENT, INC."))
target_exp$recipient_state <- state.name[match(target_exp$recipient_state, state.abb)]
target_exp <- target_exp[complete.cases(target_exp$recipient_state), ]
  
# Compute amount of Biden & Trump committee disbursement per category and state 
exp_flow_B <- target_exp %>%
  filter(committee_name == "BIDEN FOR PRESIDENT") %>%
  dplyr::group_by(recipient_state) %>%
  dplyr::summarise(value = sum(disbursement_amount))

exp_flow_T <- target_exp %>%
  filter(committee_name == "DONALD J. TRUMP FOR PRESIDENT, INC.") %>%
  dplyr::group_by(recipient_state) %>%
  dplyr::summarise(value = sum(disbursement_amount))

# Graph Highchart for Biden committee
blue <- RColorBrewer::brewer.pal(5, "Blues")
highchart(type="map") %>%
hc_title(text = "Total Disbursements By 2020 Joe Biden Committee By State") %>%
  hc_subtitle(text = "Double click on the state area to zoom in") %>%
  hc_add_series_map(usgeojson, exp_flow_B,
    name = "Total Disbursements",
    value = "value", joinBy = c("woename", "recipient_state"),
    dataLabels = list(
       enabled = TRUE,
       format = "{point.properties.postalcode}"
     ),
    tooltip = list(
      valueDecimals = 0,
      valuePrefix = "$",
      valueSuffix = " USD"
     )
   ) %>%
   hc_colorAxis(min=1e3, max=max(exp_flow_T$value),type="logarithmic", stops = color_stops(n=length(blue), colors = blue), endOnTick=FALSE) %>%
   hc_legend(title = list(text = "US Dollar Amount"), valueDecimals = 0, valueSuffix = "%") %>%
   hc_mapNavigation(enabled = TRUE) %>% 
  hc_exporting(enabled = TRUE)
```


```{r, message=FALSE, warning=FALSE,fig.width=20, fig.height=6}
# Graph Highchart for Trump's Main committee
red <- RColorBrewer::brewer.pal(5, "Reds")
highchart(type="map") %>%
hc_title(text = "Total Disbursements By 2020 Donald Trump Committee By State") %>%
  hc_subtitle(text = "Double click on the state area to zoom in") %>%
  hc_add_series_map(usgeojson, exp_flow_T,
    name = "Total Disbursements",
    value = "value", joinBy = c("woename", "recipient_state"),
    dataLabels = list(
       enabled = TRUE,
       format = "{point.properties.postalcode}"
     ),
    tooltip = list(
      valueDecimals = 0,
      valuePrefix = "$",
      valueSuffix = " USD"
     )
   ) %>%
   hc_colorAxis(min=1e3, max=max(exp_flow_T$value),type="logarithmic",stops = color_stops(n=length(red), colors = red), endOnTick=FALSE) %>%
   hc_legend(title = list(text = "US Dollar Amount"), valueDecimals = 0, valueSuffix = "%") %>%
   hc_mapNavigation(enabled = TRUE) %>% 
  hc_exporting(enabled = TRUE)
```

The two maps above show how much Biden and Trump have spent in each state, and please note that the legends are in log scales. We can see the efforts they have put in some battlegrounds states, and it seems that neither of them has made significant investments to states in the central America. Biden spent the most in **Georgia** which was equal to 360.8 million dollars, and he also spent significant amounts in **New York**, **California**, **Pennsylavania**, and **Massachusetts**. Among these states, Biden successfully flipped and won **Georgia** and **Pennsylavania** which Democratics lost in 2016. On the other hand, Trump invested the most in **Virginia**, **New York**, **New Hampshire**, **Louisiana**, and **Florida**. Trump spent 347.6 million dollars in Virginia, 21.3 million dollars in New York, and 11.0 million dollars in New Hampshire. Trump's expenditures in Virginia were more than 10 times of the amounts spent in New York, but unfortunately he lost Virginia by a 10% margin. When looking at other three flipped states **Michigan**, **Wisconsin**, and **Arizona**, we were surprised to find out that Trump has invested more than Biden in all three states. 

From this, it seems that Trump's spending strategy was not effective in helping him win key states. His spendings on public rallies and campaign materials during a pandemic did not bring him significant votes he needed. 
