# Results

```{r, message=FALSE, warning=FALSE, echo=FALSE}
library(choroplethr)
library(d3treeR)
library(d3r)
library(gganimate)
library(GGally)
library(gridExtra)
library(HH)
library(here)
library(highcharter)
library(MASS)
library(parcoords)
library(plotly)
library(readr)
library(scales)
library(stringr)
library(tidyverse)
library(treemap)
library(usdata)
```

## Election Vote Results Visualizations
### State-level

```{r}
# load packages
library(here)
library(tidyverse)
library(statebins)
library(usmap)
library(ggplot2)
library(dplyr)
library(plyr)
library(socviz)
library(ggrepel)
library(readr)
library(ggthemes)
library(gifski)
library(gganimate)
library(directlabels)
library(png)
#library(transformr)
library(grid)

# load cleaned dataset
president2020 <- readr::read_csv(here("./data/clean/president2020.csv"))
```

```{r, fig.width=20, fig.height=6}
# final results (1205)
president2020 %>%
    mutate(value = ifelse(dem_votes>rep_votes,'Biden','Trump')) %>%
    statebins(
        font_size=4, dark_label = "white", light_label = "white",
        ggplot2_scale_function = scale_fill_manual,
        name = "Winner",
        values = c(Trump = "darkred", Biden = "darkblue"),
        round = TRUE, radius=grid::unit(16, "pt"), direction = 1
    ) +
    theme_statebins()+
  labs(title = "2020 US Election Results by State",caption = "Source: cookpolitical", fill = NULL)+
  theme(plot.title = element_text(face = "bold"),
        plot.caption = element_text(color = "grey68"),
        legend.position="bottom",
        axis.text.y = element_blank())

# Note: direction = 1 switches the order of the fill scale 
# so darker shades represent higher illiteracy rates
# (The default is -1).
```

### County-level
Thanks again for the great job by [*Tony McGovern*](https://github.com/tonmcg/US_County_Level_Election_Results_08-20/blob/master/2020_US_County_Level_Presidential_Results.csv)
```{r, message=FALSE,fig.width=20, fig.height=6}
County2020 <- read_csv('https://raw.githubusercontent.com/tonmcg/US_County_Level_Election_Results_08-20/master/2020_US_County_Level_Presidential_Results.csv')


# *per_dem* and *per_gop* refer to the percentage of votes going to Democrats and Republicans respectively.
# *diff* represents the absolute difference between Republican votes - Democrat votes.
# *per_point_diff* represents this difference as a percentage of total votes.

flow_T <- County2020 %>%
  select(fips, diff)
         
# Graph Highchart
highchart(type="map") %>%
hc_title(text = "2020 US Election Results: Absolute Difference") %>%
  hc_subtitle(text = "Double click the state area to zoom in") %>%
  hc_add_series_map(uscountygeojson, flow_T,
    name = "Votes_gop - Votes_dem",
    value = "diff", joinBy = "fips",
    dataLabels = list(
       enabled = TRUE,
       format = "{point.properties.postalcode}"
     )) %>%
   hc_colorAxis(minColor = "white", maxColor = "red") %>%
   hc_legend(valueDecimals = 0, valueSuffix = "%") %>%
   hc_mapNavigation(enabled = TRUE)
```

If we simply compare the area, we may conclude that Trump will win this election. However, don't forget electoral votes are related to population. 

### Time-level

In this part, I will compare popular vote and electoral college vote from 1824 to 2020 (Note that **Data for 2020 are provisonal**, collected in 5 Dec). *It's possible the candidate with the most votes from the public won't be the winner. This is because the president is not chosen directly by the voters, but what's known as the electoral college. (This explained by [BBC](https://www.bbc.com/news/world-us-canada-53558176) )*

```{r,fig.width=20, fig.height=6}
# Code reference: https://socviz.co/workgeoms.html#workgeoms
# HIGHLY recommended this book!! Really APPRECIATE:)

elections_historic_new <- readr::read_csv(here("./data/clean/elections_historic_new.csv"))

# plot
ggplot(elections_historic_new, aes(x = popular_pct, 
                                   y = ec_pct,
                                   label = winner_label))+
  geom_hline(yintercept = 0.5, size = 1.4, color = "gray80")+
  geom_vline(xintercept = 0.5, size = 1.4, color = "gray80")+
  geom_point(aes(colour = factor(win_party))) +
  geom_text_repel(size = 2) + # deal with overlapping labels
  scale_x_continuous(labels = scales::percent) +
  scale_y_continuous(labels = scales::percent) +
  annotate(geom = "rect", xmin = 0.37, xmax = 0.497, ymin = 0.51, ymax = 0.85, fill = "red", alpha = 0.2) + 
  annotate(geom = "text", x = 0.35, y = 0.9, label = "Electoral vote is high \nbut with low share of popular vote", hjust = 0)+
  labs(x = "Winner's share of popular vote", 
       y = "Winner's share of electoral college vote", 
       title = "Presidential Elections: Popular & Electoral College Margins", subtitle = "From 1824 to 2020(Data for 2020 are provisional)",
       caption = "Source: socviz::elections_historic & google", fill = "Party affiliation of winner")+
  theme_bw() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"),
        axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position="bottom")
```

From this plot, we can see: 

- Ideally, we may think the president also have high share of popular vote. Those data in the red rectangular shows not this case. This can be explained by [how the US presidential election works](https://en.wikipedia.org/wiki/United_States_presidential_election).

- Adams 1824 may be regarded as an outlier. However, after looking up Wiki, He is actually from Democratic-Republican Party.
- Finally, I can regard Roosevelt as an outstanding candidate since his electoral vote and popular vote are very high.

\n
Finally, we compare the share of electoral college vote between *Dem.* and *Rep.*.
```{r}
compare <- readr::read_csv(here("./data/clean/compare.csv"))

# plot
p <- ggplot(compare, aes(Year, Votes_PERCEN, frame = Year, size = Votes_PERCEN, group = Party,colour = Party)) +
  geom_point()+
  scale_color_manual(values=c("#19609F","#CB1C2A"))+
  transition_time(Year) +
  shadow_wake(wake_length = 0.05, alpha = FALSE) +
  labs(x = "", y = "", 
      title = "Presidential Elections:The Share of Electoral Votes for Dem. and Rep. Respetively", subtitle = "Year : {frame_time} (Data for 2020 are provisional)",
       caption = "Source: socviz::elections_historic & google", fill = NULL)+
  #coord_cartesian(clip = 'off') + 
  #ease_aes('cubic-in-out')+
  theme_classic()

animate(p, fps = 3)
```


From this plot, we can see: Excluding year ftom 1875-1900, the votes percentage difference is relatively huge.

## Contribution Receipts Data Analysis
### Contributions Overview
```{r, echo=FALSE}
# Read the datasets
  # Contribution summary by state
contrib_zip <- readr::read_csv(here("data", "clean", "Contributions_by_3Zip.csv"))

  # Population and registered Voters in 2020 by state
voters_state <- readr::read_csv(here("data", "clean", "RegisteredVotersByState.csv"))

# All candidates
df_all <- contrib_zip[contrib_zip$CANDIDATE_ID=="P00000001" & 
              contrib_zip$ZIP_3=="STATE TOTAL",] %>%
  dplyr::rename(ALL_RECEIPT_AMOUNT = CONTRIB_RECEIPT_AMOUNT)
	
# Biden = P80000722
df_biden <- contrib_zip[contrib_zip$CANDIDATE_ID=="P80000722" & 
              contrib_zip$ZIP_3=="STATE TOTAL",]%>%
  dplyr::rename(BIDEN_RECEIPT_AMOUNT = CONTRIB_RECEIPT_AMOUNT)
# Trump = P80001571
df_trump <- contrib_zip[contrib_zip$CANDIDATE_ID=="P80001571" & 
              contrib_zip$ZIP_3=="STATE TOTAL",] %>%
  dplyr::rename(TRUMP_RECEIPT_AMOUNT = CONTRIB_RECEIPT_AMOUNT)

# Join with state populations
data("statepop")
statepop1 <- statepop[,c(1:3)] %>%
  left_join(voters_state[,c(1:4)],by = c("full" = "State" )) %>%
  left_join(df_all[,c(3,6)], by = c("abbr" = "CONTRIB_STATE")) %>%
  left_join(df_biden[,c(3,6)], by = c("abbr" = "CONTRIB_STATE")) %>%
  left_join(df_trump[,c(3,6)], by = c("abbr" = "CONTRIB_STATE")) 


# Calculate contribution amounts per registered voter of each state
statepop1 <- statepop1 %>%
  mutate(ALL_CONTRIB_PP = round(ALL_RECEIPT_AMOUNT/totalRegistered, 2))%>%
  mutate(BIDEN_CONTRIB_PP = round(BIDEN_RECEIPT_AMOUNT/totalRegistered, 2))%>%
  mutate(TRUMP_CONTRIB_PP = round(TRUMP_RECEIPT_AMOUNT/totalRegistered, 2))

#remove(voters_state, statepop, df_trump, df_biden, df_all)
```

#### Total Contributions by State
```{r, echo=FALSE}
# All states
data("usgeojson", package = "highcharter")
highchart() %>%
hc_title(text = "Total Contributions to All Presidential Candidates 2020 By State") %>%
  hc_subtitle(text = "Double click the state area to zoom in") %>%
  hc_add_series_map(usgeojson, statepop1,
    name = "Total Contributions",
    value = "ALL_RECEIPT_AMOUNT", joinBy = c("postalcode", "abbr"),
    dataLabels = list(
       enabled = TRUE,
       format = "{point.properties.postalcode}"
     ),
    tooltip = list(
      valueDecimals = 0,
      valuePrefix = "$",
      valueSuffix = " USD"
     )
   ) %>%
   hc_colorAxis(minColor = "white", maxColor = "orange") %>%
   hc_legend(valueDecimals = 0, valueSuffix = "%") %>%
   hc_mapNavigation(enabled = TRUE) 
```

As shown in the above map, California has contributed the most to all presidential candidates in 2020 US Election, which exceeded 260 million US dollars. New York, Texas, and Florida also made significant contributions. However, some states like Wyoming and West Virginia only contributed less than 30 million US dollars.

```{r, echo=FALSE}
# Biden
p1<- statepop1 %>% arrange(desc(BIDEN_RECEIPT_AMOUNT)) %>% head(5) %>% 
  mutate(BIDEN_RECEIPT_AMOUNT = round(BIDEN_RECEIPT_AMOUNT/1000000,3)) %>%
  ggplot(aes(x=reorder(abbr, BIDEN_RECEIPT_AMOUNT, median), y=BIDEN_RECEIPT_AMOUNT)) +
    geom_bar(stat="identity", fill="dodgerblue3") +
    geom_text(aes(label=BIDEN_RECEIPT_AMOUNT), hjust=1.2, color="white", size=3.5) +
    coord_flip() +
    # formatting
    ggtitle("Joe Biden") +
    labs(y = "Contribution Amount (Million $)", x = "State",caption = " ") +
    theme_minimal() +
    theme(plot.title = element_text(size = 11,face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"))

# Trump
p2<- statepop1 %>% arrange(desc(TRUMP_RECEIPT_AMOUNT)) %>% head(5) %>% 
  mutate(TRUMP_RECEIPT_AMOUNT = round(TRUMP_RECEIPT_AMOUNT/1000000,3)) %>%
  ggplot(aes(x=reorder(abbr, TRUMP_RECEIPT_AMOUNT, median), y=TRUMP_RECEIPT_AMOUNT)) +
    geom_bar(stat="identity", fill="firebrick2") +
    geom_text(aes(label=TRUMP_RECEIPT_AMOUNT), hjust=1.2, color="white",size=3.5) +
    coord_flip() +
    # formatting
    ggtitle("Donald Trump") +
    labs(y = "Contribution Amount (Million $)", x = " ",caption = "Source: fec.gov") +
    theme_minimal() +
    theme(plot.title = element_text(size = 11, face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"))

# Plot in a grid
grid.arrange(p1, p2, ncol=2, nrow=1,
     top = textGrob("Contributions to Presidential Candidates of 2020 US Election\nTotal Contributions Ranked by State",gp=gpar(fontsize=13, fontface = "bold")))

```

The bar chart above focuses on the total amounts raised by the final presidential candidates Joe Biden and Donald Trump, and it displays top 5 states that contributed the most to each candidate. Joe Biden received  solid support from California and New York which contributed 127M dollars and 63M dollars respectively, more than twice as contributed to Donald Trump. Donald Trump raised significant amounts from Texas and Florida, and these are consistent with the final voting results.

#### Contributions Per Registered Voter by State
```{r, echo=FALSE}
# Biden
p3<- statepop1 %>% arrange(desc(BIDEN_CONTRIB_PP)) %>% head(5) %>% 
  ggplot(aes(x=reorder(abbr, BIDEN_CONTRIB_PP, median), y=BIDEN_CONTRIB_PP)) +
    geom_bar(stat="identity", fill="dodgerblue3") +
    geom_text(aes(label=BIDEN_CONTRIB_PP), hjust=1.2, color="white", size=3.5) +
    coord_flip() +
    # formatting
    ggtitle("Joe Biden") +
    labs(y = "Contribution Amount (US Dollar)", x = "State",caption = " ") +
    theme_minimal() +
    theme(plot.title = element_text(size = 11,face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"))

# Trump
p4<- statepop1 %>% arrange(desc(TRUMP_CONTRIB_PP)) %>% head(5) %>% 
  ggplot(aes(x=reorder(abbr, TRUMP_CONTRIB_PP, median), y=TRUMP_CONTRIB_PP)) +
    geom_bar(stat="identity", fill="firebrick2") +
    geom_text(aes(label=TRUMP_CONTRIB_PP), hjust=1.2, color="white", size=3.5) +
    coord_flip() +
    # formatting
    ggtitle("Donald Trump") +
    labs(y = "Contribution Amount (US Dollar)", x = " ",caption = "Source: fec.gov") +
    theme_minimal() +
    theme(plot.title = element_text(size = 11, face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"))

# Plot in a grid
grid.arrange(p3, p4, ncol=2, nrow=1,
     top = textGrob("Contributions to Presidential Candidates of 2020 US Election\nContributions Per Registered Voter Ranked by State",gp=gpar(fontsize=13, fontface = "bold")))

```

If we instead take into account the registered voters in each state and calculate contributions per registered voter, we found that District of Columbia has the highest average contribution to Biden, which is 37 dollars per registered voter, way more than other states. This is likely due to a smaller population thereby fewer registered voters in DC. In addition, Wyoming surprisingly has contributed the most to Trump on an average level, and a possible reason is that the percentage of registered voters is the lowest in Wyoming, and only 47.4% of Wyoming's population registered to vote.


### Contributions Distribution and Details
```{r, echo=FALSE}
# Read data
contributions1 <- readr::read_csv(here("data", "clean", "contribution_processed.csv"))

#head(contributions1)

#summary(contributions1)

# Factorize categorical variables
contributions1$committee_name <- as.factor(contributions1$committee_name)
```
```{r, message=FALSE, warning=FALSE, echo = FALSE, results = "asis"}
# Calculate the summary statistics of contributions by candidate
contr_sum <- contributions1 %>%
  select(committee_name,contribution_receipt_amount) %>%
  dplyr::group_by(committee_name) %>% 
  dplyr::summarise(number_of_contributions = n(),
                   total_raised_amount = sum(contribution_receipt_amount),
            mean_contribution = mean(contribution_receipt_amount, na.rm = T),
            median_contribution = median(contribution_receipt_amount, na.rm = T))

# Display in a table
knitr::kable(contr_sum, caption = "Contributions Summary by Candidate",
             col.names = c('Candidate name','Number of contributions',
                           'Total raised amount (US Dollars)',
                           'Mean contribution (US Dollars)','Median contribution (US Dollars)'),
             format.args = list(big.mark = ",", scientific = FALSE),
             digits = 2,align = "l",full_width = T)
```

```{r, fig.cap="Domestic Individual Contribution Distribution",echo=FALSE}
# Generate the boxplot
ggplot(contributions1, aes(x=contribution_receipt_amount, fill = committee_name), alpha=0.8) + 
  geom_boxplot() + 
  stat_boxplot(geom ='errorbar') +
  scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x),
              labels = trans_format("log10", math_format(10^.x)))+
  scale_fill_manual(name = "Committee name", values = c("dodgerblue3", "firebrick2"), 
                    labels = c("Joe Biden","Donald Trump")) +
  # formatting
  ggtitle("Contributions to Presidential Candidates of 2020 US Election",
          subtitle = "Domestic Individual Contribution Amounts Received in 2020 (log10 scaled)") +
  labs(y = "Candidate", x = "Contribution Amount ($)",caption = "Source: fec.gov") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"),
        legend.position="bottom",
        axis.text.y = element_blank())

```

To see more contribution details, we selected from the original data the domestic individual contributions with amounts higher than 200 dollars received by two presidential candidates. As shown in the contributions summary table, Biden received double the number of contributions and the total amounts of funds as Trump did, but the mean and median contributions to Trump are higher than to Biden. The log10 scaled boxplot above also demonstrates the difference in median contributions, and in addition, it shows that the contributions distributions for both candidates are largely right skewed with a good number of outliers. This makes sense as the majority of individuals contributed less than 500 dollars. 


### Contributions by Date: Time Series
```{r, echo=FALSE}
# Read the dataset
contribution_by_date <- readr::read_csv(here("data", "clean", "contribution_by_date.csv"))

# Convert format
contribution_by_date$contribution_receipt_date <-
  as_date(contribution_by_date$contribution_receipt_date)
contribution_by_date$committee_name <-
  as.factor(contribution_by_date$committee_name)

ts <- contribution_by_date[order(contribution_by_date$contribution_receipt_date, 
                                 decreasing= F),]

# Interactive time series plot with highcharter
ts %>%
  hchart("area",hcaes(x = contribution_receipt_date, y = Total, 
                      group = committee_name)) %>%
  hc_chart(zoomType = "x") %>%
  hc_colors(c("#0015BC", "#FF0000")) %>%
  hc_legend(align = "center", verticalAlign = "bottom",layout = "horizontal") %>%
  hc_xAxis(title = list(text = "Contribution Receipt Date"),
           labels = list(format = '{value:%b %d}')) %>%
  hc_yAxis(title = list(text = "Contribution Amount (US Dollars)"),
           tickInterval = 2000000,
           max = 14000000) %>%
  hc_title(text = "<b>Individual Contributions to Presidential Candidates 2020</b>") %>%
  hc_subtitle(text = "Click and drag in the plot area to zoom in") %>%
  hc_plotOptions(area = list(lineWidth = 0.5))
```

We also grouped data points by receipt date and calculated the daily raisings of each candidate from January 1, 2020 to October 15, 2020, which are shown the plot above. It is clear that Joe Biden generally raised more funds than Donald Trump. There was a small peak in raisings for Biden in the early March that paralleled Biden's win in the South Carolina Democratic presidential primary, which we learned from the [news](https://edition.cnn.com/2020/03/01/politics/joe-biden-south-carolina-fundraising-february-cnntv/index.html) of the time. 
More notably, Biden achieved success in fundraising from mid-August, and Biden's daily raisings hit the 13.6M dollars on August 20, 2020 by the time he [officially accepted the Democratic nomination](https://www.nytimes.com/2020/08/20/us/politics/Joe-Biden-accepts-democratic-nomination.html).
Although Donald Trump also received more funds in the second half year, the contributions to Trump did not significantly increase as the election season approached. 


### Contributor Occupations

To obtain more information about individual contributors, we extracted keywords in each contributor's occupation and divide by candidate, so that we were able to draw word clouds for each candidate.

```{r,echo=FALSE}
# To save time, read the saved .csv datasets
oc_biden_count <- readr::read_csv(here("data", "clean", "occupation_BIDEN_count.csv"))

oc_trump_count <- readr::read_csv(here("data", "clean", "occupation_TRUMP_count.csv")

  
# Wordcloud Biden
# Reference: https://www.r-graph-gallery.com/196-the-wordcloud2-library.html
pal_blue <- c("blue","#1F45FC","#2B60DE","#0000A0","#6698FF","#1589FF") #blue color palette
df_biden <- oc_biden_count
df_biden$freq <- (df_biden$freq)^(1/3) #scale the frequencies
```

#### *50 most popular occupations of contributors who supported Joe Biden*
```{r, echo=FALSE, message=FALSE, warning=FALSE, results="asis"}
w1<- wordcloud2(df_biden, size = 0.4,
         maxRotation = 0, minRotation = 0,
         color=rep_len(pal_blue, nrow(df_biden)))
w1
library(htmlwidgets)
library(webshot)
saveWidget(w1,"w1.html",selfcontained = F)
#knitr::include_graphics("./w1.PNG")
```

To display words properly, the word size of the word cloud was scaled by extracting a cube root of the word frequency count. The above word cloud for Joe Biden clearly shows that a great proportion of contributors are not employed, and attorney, physician, engineer, and manager are also popular occupations.

#### *50 most popular occupations of contributors who supported Donald Trump*
```{r, echo=FALSE, message=FALSE, warning=FALSE, results="asis"}
# Wordcloud Trump
pal_red <- c("red","#F70D1A","#E77471","#F62217","#9F000F","#F75D59") #red color palette
df_trump <- oc_trump_count
df_trump$freq <- (df_trump$freq)^(1/3) #scale the frequencies

w2<- wordcloud2(df_trump, size = 0.4,
         maxRotation = 0, minRotation = 0,
         color=rep_len(pal_red, nrow(df_trump)))
w2
#saveWidget(w2,"w2.html",selfcontained = F)
#knitr::include_graphics("./w2.PNG")
```

Compared to the blue word cloud, this one for Trump has a smaller size consistent to a small total number of contributors. The most prominent word is Retired, which implies that contributors who supported Trump are dominantly retired. Besides, entrepreneur, owner, and manager are popular occupations. The actual frequency counts are shown in the following bar chart.

```{r, fig.height=5, echo=FALSE}
# Bar charts of contributor occupations

# Biden
g1<- oc_biden_count %>% head(10) %>% 
  ggplot(aes(x=reorder(oc_str_sp, freq, median), y=freq)) +
    geom_bar(stat="identity", fill="dodgerblue3") +
    geom_text(aes(label=freq), hjust=-0.05, size=3) +
    coord_flip() +
    ylim(0, 220000) +
    # formatting
    ggtitle("Joe Biden") +
    labs(y = "Frequency", x = "Contributor occupation",caption = " ") +
    theme_minimal() +
    theme(plot.title = element_text(size = 11, face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"))

# Trump
g2<- oc_trump_count %>% head(10) %>% 
  ggplot(aes(x=reorder(oc_str_sp, freq, median), y=freq)) +
    geom_bar(stat="identity", fill="firebrick2") +
    geom_text(aes(label=freq), hjust=-0.05, size=3) +
    coord_flip() +
    ylim(0, 155000) +
    # formatting
    ggtitle("Donald Trump") +
    labs(y = "Frequency", x = " ",caption = "Source: fec.gov") +
    theme_minimal() +
    theme(plot.title = element_text(size = 11, face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"))


# Plot in a grid
grid.arrange(g1, g2, ncol=2, nrow=1,
     top = textGrob("Contributions to Presidential Candidates of 2020 US Election\nContributor Occupation Distribution",gp=gpar(fontsize=13, fontface = "bold")))

```

Comparing difference between candidates, more than half of 10 top occupations of Joe Biden's contributors are legal or technical professional positions, whereas more than half of 10 top occupations of Donald Trump's contributors are jobs in business. 

## Disbursement Data Analysis
### Disbursement Distribution
```{r, message=FALSE, warning=FALSE}
exp_df <- readr::read_csv(here("data", "clean", "disbursement_processed.csv"))
exp_df$disbursement_date <- as.Date(exp_df$disbursement_date, format="%Y-%m-%d %H:%M:%S")
# Calculate the total disbursement by committee
disbursement_sum <- exp_df %>% 
  filter(committee_name == 'BIDEN FOR PRESIDENT' | committee_name == 'DONALD J. TRUMP FOR PRESIDENT, INC.') %>% 
  filter(disbursement_amount > 0)
  
# Generate the boxplot
ggplot(disbursement_sum, aes(x=disbursement_amount, y= committee_name, fill=committee_name), alpha=0.8) + 
  geom_boxplot(varwidth = TRUE) + 
  stat_boxplot(geom ='errorbar') + 
  scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x),
              labels = trans_format("log10", math_format(10^.x)))+
  scale_fill_manual(name = "Committee name", values = c("dodgerblue3", "firebrick2"), 
                    labels = c("Joe Biden","Donald Trump")) +
  labs(y = "Candidate", x = "Disbursement Amount",caption = "Source: fec.gov", 
       title="Disbursement Made by Presidential Committees of 2020 US Election",
       subtitle = "in US Dollar (log10 scaled)") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"),
        legend.position="bottom",
        axis.text.y = element_blank())
```


```{r}
disbursement_summary <- disbursement_sum %>%
  select(committee_name, disbursement_amount) %>%
  dplyr::group_by(committee_name) %>% 
  dplyr::summarise(number_of_records = n(),
                   total_disbursed_amount = sum(disbursement_amount),
            mean_disbursement = mean(disbursement_amount, na.rm = T),
            median_disbursement = median(disbursement_amount, na.rm = T))

# Display in a table
knitr::kable(disbursement_summary, caption = "Disbursement Summary by Candidate",
             col.names = c('Candidate name','Number of Records',
                           'Total disbursed amount (US Dollars)',
                           'Mean disbursement amount (US Dollars)','Median disbursement amount (US Dollars)'),
             format.args = list(big.mark = ",", scientific = FALSE),
             digits = 2,align = "l",full_width = T)
```
Every expenditure made by Trump Committee are evenly spread out from 0 to less than a million. The distribution is a little left skewed. There are more outliers clustering at the higher expenditure level than lower expenditure level. On the other hand, Biden Committee has their expenditure distribution centered symmetrically around their median. The range of Biden Committee's single expenditure is wider than Trump Committee. There are more outliers clustering at the higher expenditure level, which means Biden Committee's made more large transactions than Trump Committee. 


### Top 15 Presidential Campaign Made the Most Disbursement
```{r, message=FALSE, warning=FALSE}
# Calculate the total disbursement amount by committee (in million)
# Get the top 15 committee
com_exp <- exp_df %>%
  group_by(committee_name) %>% 
  summarize(total = round((sum(disbursement_amount) / 1e6), 2)) %>%
  arrange(desc(total)) %>% 
  slice(1:15) %>%
  ungroup()

# Find the corresponding Political Party for the committee
com_exp$PoliticalParty <- c('D', 'D', 'R', 'D', 'D','D', 'D', 'D', 'D', 'I','D', 'R', 'I', 'L', 'D')

# Factorize the Political Party Column
com_exp$PoliticalParty <- factor(com_exp$PoliticalParty, 
                              levels=c("D", "R", "I", "L"), 
                              labels=c("Democratic", "Republican", "Independent", "Libertarian"))

# Store the top 15 Committee and their party into a variable
top15_pp <- com_exp %>% select(c("committee_name", "PoliticalParty"))

# Generate the Interactive Cleveland Dot Plot
ggplot(com_exp, aes(x = total, y = reorder(committee_name, total), color=PoliticalParty, label=total)) +
  geom_point() + 
  geom_text(hjust=-0.2, size = 3) +
  scale_x_continuous(limits=c(1,1000)) +
  scale_color_manual(name = "Political Party", values = c("dodgerblue3", "firebrick2","mediumorchid4","gold2"), 
                    labels = c("Democratic","Republican", "Independent", "Libertarian")) +
  scale_y_discrete(labels=c('Kamala Harris','Jo Jorgensen','Brock Pierce','Roque De La Fuente','Cory Booker',
                            'Kanye West','John Delaney','Andrew Yang','Amy Klobuchar', 'Elizabeth Warren', 
                            'Bernie Sanders', 'Tom Steyer', 'Donald Trump', 'Joe Biden', 'Mike Bloomberg')) +
  labs(x = "Total Expenditure (Million $)", y = "Candidate", caption = "Source: fec.gov", 
       title ="Top 15 Presidential Campaign Made the Most Disbursement", 
       subtitle = "2020 Presidential Election (Rounded to 2 Digits)") + 
  theme_bw() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"),
        legend.position="bottom")
```

The above graph shows 15 committees with the most disbursement made. Among these 15 committees, 10 of them are Democrates, 2 of them are Republicans, and 2 of them are Independent, 1 of them is Libertarian. One interesting finding is that Mike Bloomberg's Committee spend the most among all of the committees. This is not expected since Bloomberg quit the election race early in March 2020. Joe Biden's committee and Donald Trump's committee gets the second and third place on the list, and this is what is expected since they are the main candidates in this election. We can see that this distribution is following an exponential trend. Each committee spends twice more than the committee that is ranked after it. 

### Disbursement Details
```{r, message=FALSE, warning=FALSE, fig.width=15, fig.height=8}
exp_perc <- exp_df %>% 
  filter(exp_df$committee_name %in% com_exp$committee_name & exp_df$disbursement_purpose_category != "REFUNDS") %>% 
  group_by(committee_name, disbursement_purpose_category) %>% 
  summarise(total = sum(disbursement_amount)) %>%
  mutate(Freq = 100 * total / sum(total)) %>%
  arrange(committee_name)

exp_perc <- pivot_wider(exp_perc, 
            id_cols=committee_name, 
            names_from=disbursement_purpose_category,
            values_from = Freq)
exp_perc$committee_name <- factor(exp_perc$committee_name)
exp_perc[is.na(exp_perc)] <- 0

exp_perc %>%
  ggparcoord(columns = c(2:9,11:13,10),
             groupColumn = 1,
             showPoints = T,
             scale = "globalminmax",
             mapping=aes(color=committee_name)
             ) + 
  scale_color_viridis_d("Committee",labels=levels(exp_perc$committee_name)) +
  labs(x = "Expenditure Category", y = "Percentage of Total Expenditure", caption = "Source: fec.gov", 
       title ="2020 Presidential Election Disbursement Break Down",
       subtitle="Excluding Refunds") + 
  theme_bw() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"),
        legend.position="bottom")
```

The three areas that most of the committees focus on are Administrative, Advertising, and Consulting. Those categories are which the services could be provided virtually. Compare to those categories, disbursements in Travel, Events, and Materials are relatively low. Since those categories require in-person meetings and activities, this trend could be caused by the COVID pandemics this year. After investigating the above graph in an interactive plot, there is no obvious correlation between each pair of the disbursement categories listed above. So we will not include the interactive parallel plot explicitly here. 

### When does those committee spend the most?
#### Spending Trend of Two Major Committees
```{r, message=FALSE, warning=FALSE}
biden_Trend <- exp_df %>% 
  filter(committee_name == "BIDEN FOR PRESIDENT" & disbursement_amount > 0)
biden_Trend <- aggregate(biden_Trend$disbursement_amount,
                         by=list(lubridate::floor_date((biden_Trend$disbursement_date), "week")), 
                         sum)
biden_Trend$x <- 100 * biden_Trend$x / sum(biden_Trend$x)
biden_Trend$Committee <- "BIDEN FOR PRESIDENT"

trump_Trend <- exp_df %>% 
  filter(committee_name == "DONALD J. TRUMP FOR PRESIDENT, INC." & disbursement_amount > 0)

trump_Trend <- aggregate(trump_Trend$disbursement_amount,
                         by=list(lubridate::floor_date((trump_Trend$disbursement_date), "week")), 
                         sum)

trump_Trend$x <- 100 * trump_Trend$x / sum(trump_Trend$x)
trump_Trend$Committee <- "DONALD J. TRUMP FOR PRESIDENT, INC."

ggplot(rbind(biden_Trend, trump_Trend),
       aes(x=Group.1, y=x, color=Committee)) +
  geom_point() + 
  geom_line() + 
  geom_line(stat = "smooth", method = "loess", alpha = 0.5) + 
  scale_x_date(labels = date_format("%m-%d"), 
               limits = c(min=as.Date("2020-01-01"), max=as.Date("2020-11-04")), 
               breaks = date_breaks("2 week")) + 
  scale_y_continuous(limits=c(0,15)) +
  scale_color_manual(values=c("dodgerblue3", "firebrick2")) + 
  labs(x = "Date", y = "Percent of Committee's Disbursement", caption = "Source: fec.gov", 
       title = "Percent of Total Disbursements Made by Presidential Committee per Day",
       subtitle = "2020 Presidential Election") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"),
        plot.subtitle = element_text(face = "bold", color = "grey35"),
        plot.caption = element_text(color = "grey68"),
        axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position="bottom")
```

From the above graph, we can see both of the committees are spending more and more as election day approaches.Th ere are some spending trend fluctuation in early 2020, but such fluctuation evens out as time goes on. Trump's committee started earlier than Biden's committee to invest money in activities regards this election. We can see this in the part of trend in January and the mass investment starting in April. Trump's committee spending trend has three peaks in the graph, which are in January, late May to early July, and late September to early October. On the other hand, Biden's committee started their disbursement later but the total disbursement grows more rapidly. There are two obvious peak in Biden's committee's spending trend line, which are in May and late September to early October.

### Disbursement Recipient Share 
```{r, message=FALSE, warning=FALSE, fig.width=15, fig.height=10}
# Calculate the total disbursement received by recipients
recipients_df <- exp_df %>% 
  group_by(disbursement_purpose_category, recipient_name) %>% 
  summarise(value = sum(disbursement_amount)) %>%
  arrange(disbursement_purpose_category, desc(value))
recipients_df <- filter(recipients_df, value > 0)

# select top 10 recipients among each disbursement category
top10_recipients <- recipients_df %>% 
  arrange(disbursement_purpose_category, desc(value)) %>% 
  group_by(disbursement_purpose_category) %>% 
  slice(1:10)


# Graph Treemap based on the top 10 recipients among each category
dout <- data_to_hierarchical(data = top10_recipients, 
           group_vars=c("disbursement_purpose_category","recipient_name"),
           size_var = "value") 
hchart(dout, type="treemap", allowTraversingTree=TRUE) %>%
  hc_title(text = "<b>Major Disbursement Recipients in Each Category</b>") %>%
  hc_tooltip(pointFormat = "<b>{point.name}</b>:<br>
                            Total (US Dollar): {point.value:,.0f}")
```
This graph matches what we have discovered before. Most of the committees focus on advertising to help them win the election. Media Assembly and Media Buying & Analytics.LLC are two major companies that provides media advertising services to the 2020 election. As expected, there are also some large tech companies like Google and Facebook in this section. There are also many disbursements for administrative and consulting purposes. Administrative and consulting are the next two largest sectors. They get about equal share of the total disbursements. Zenefits, Vensure HR.LLC, ADP.LLC are three major recipients in the Administrative section. All of these three companies provides Human Resource supports such as H.R. Management software system. In the Consulting section, we see data analytics and financial consulting companies such as Hawkfish.LLC and Geller & Company.LLC. In Other section, there are banks, tech service companies, as well as Vensure HR.LLC and Hawkfish.LLC that we have seen earlier. Though we are unable to specify which purpose those disbursements are for, it is highly likely that those disbursements would be related to financial and other minor transactions regarding the services committees purchased from those supporting companies. 

### Where Does All of The Disbursement Money Go?
We are going to visualize the disbursement distribution across the 50 states in U.S in the next step:
```{r,  message=FALSE, warning=FALSE,fig.width=10, fig.height=6}
data("usgeojson", package = "highcharter")
# Calculate Total Amount of Disbursement Received for Each Location
state_total <- exp_df %>% 
  group_by(recipient_state) %>% 
  summarise(value= sum(disbursement_amount))

state_total$recipient_state <- state.name[match(state_total$recipient_state, state.abb)]
state_total <- state_total[complete.cases(state_total), ]

highchart(type="map") %>%
hc_title(text = "Total Disbursements By All Presidential Candidates 2020 By State") %>%
  hc_subtitle(text = "Double click the state area to zoom in") %>%
  hc_add_series_map(usgeojson, state_total,
    name = "Total Disbursements",
    value = "value", joinBy = c("woename", "recipient_state"),
    dataLabels = list(
       enabled = TRUE,
       format = "{point.properties.postalcode}"
     ),
    tooltip = list(
      valueDecimals = 0,
      valuePrefix = "$",
      valueSuffix = " USD"
     )
   ) %>%
   hc_colorAxis(minColor = "white", maxColor = "red") %>%
   hc_legend(valueDecimals = 0, valueSuffix = "%") %>%
   hc_mapNavigation(enabled = TRUE)
```
Disbursement mainly goes towards the companies on the Southern and Northern-East Side of the United States. This result is consistent to [2019 Q4 U.S Real GDP data](https://apps.bea.gov/iTable/iTable.cfm?reqid=70&step=30&isuri=1&major_area=0&area=xx&year=2019&tableid=532&category=5532&area_type=0&year_end=-1&classification=non-industry&state=0&statistic=1&yearbegin=-1&unit_of_measure=levels) reported by the Bureau of Economic Analysis.Those states that are highlighted in dark blue are the states that contribute the most to the U.S's GDP. Compare to the 2020 election result, all of these states that contributes the most to the U.S total GDP, besides Taxas, voted for Joe Biden. Such pattern discontinued as we move down along the GDP level. Since the graph above includes a majority of social media and network companies, which their services can be done remotely, it would not reflect which state the candidates are focusing on to perform actions that help win the votes. On the other hand, there are two disbursement categories called `MATERIALS` and `EVENTS` that consists of the physical materials that are purchased and used locally for this presidential election, such as posters, staging materials, delivery fee, etc. If we look at the disbursement distribution across the 50 U.S. states on those categories, we might get a better idea on our previous question. In corresponding to the voting result analysis, let's focus on the two main candidates' committees.

```{r, message=FALSE, warning=FALSE,fig.width=20, fig.height=6}
# Disbursement Flow for Joe Biden's Main Committee
target_exp <- exp_df  %>%
  filter((committee_name == "BIDEN FOR PRESIDENT" | committee_name == "DONALD J. TRUMP FOR PRESIDENT, INC") &
          disbursement_purpose_category == "EVENTS" | disbursement_purpose_category == "MATERIALS")
target_exp$recipient_state <- state.name[match(target_exp$recipient_state, state.abb)]
target_exp <- target_exp[complete.cases(target_exp$recipient_state), ]
  
# Compute amount of Biden committee disbursement per category and state 
exp_flow_B <- target_exp %>%
  filter(committee_name == "BIDEN FOR PRESIDENT") %>%
  group_by(recipient_state) %>%
  summarise(value = sum(disbursement_amount))

# Graph Highchart
highchart(type="map") %>%
hc_title(text = "Total Disbursements By 2020 Joe Biden Committee By State") %>%
  hc_subtitle(text = "Double click the state area to zoom in") %>%
  hc_add_series_map(usgeojson, exp_flow_B,
    name = "Total Disbursements",
    value = "value", joinBy = c("woename", "recipient_state"),
    dataLabels = list(
       enabled = TRUE,
       format = "{point.properties.postalcode}"
     ),
    tooltip = list(
      valueDecimals = 0,
      valuePrefix = "$",
      valueSuffix = " USD"
     )
   ) %>%
   hc_colorAxis(minColor = "white", maxColor = "red") %>%
   hc_legend(valueDecimals = 0, valueSuffix = "%") %>%
   hc_mapNavigation(enabled = TRUE)
```


```{r, message=FALSE, warning=FALSE,fig.width=20, fig.height=6}
# Same steps for Trump's Main committee
# Compute amount of Biden committee disbursement per category and state 
exp_flow_T <- target_exp %>%
  filter(committee_name == "DONALD J. TRUMP FOR PRESIDENT, INC.") %>%
  group_by(recipient_state) %>%
  summarise(value = sum(disbursement_amount))

# Graph Highchart
highchart(type="map") %>%
hc_title(text = "Total Disbursements By 2020 Donald Trump Committee By State") %>%
  hc_subtitle(text = "Double click the state area to zoom in") %>%
  hc_add_series_map(usgeojson, exp_flow_T,
    name = "Total Disbursements",
    value = "value", joinBy = c("woename", "recipient_state"),
    dataLabels = list(
       enabled = TRUE,
       format = "{point.properties.postalcode}"
     ),
    tooltip = list(
      valueDecimals = 0,
      valuePrefix = "$",
      valueSuffix = " USD"
     )
   ) %>%
   hc_colorAxis(minColor = "white", maxColor = "red") %>%
   hc_legend(valueDecimals = 0, valueSuffix = "%") %>%
   hc_mapNavigation(enabled = TRUE)
```

There are not a lot of physical events going on and propaganda passing out for this year's election. Partly it could due to the COVID pandemic. From the above graph, the location where Trump's committee held physical events are more widely spread out across U.S than Biden's committee, while the recipients of material and event fee made by Biden's committee mainly clustered in the east half of the U.S. and West Coast. As shown previously in the parallel axis graph, both of the committees spent less than 1% of their total expenditure in Materials and Events. Compare both maps above, we can see some regions colored in bright green and blue in the map on the right hand side, but not the map on the left hand side. Those bright colors represent that those regions are receiving more of such committee's total disbursement. The two maps are colored based on the same color scale. Since we have found that Biden's committee spent more than Trump's Committee, and Trump's committee is spending more in the above two areas, it is not difficult to conclude that Trump's committee spent a larger percent of their total expenditure in physical events. This could be one of the campaign's strategy. Also, Trump's committee is spending significantly more on some of the states where they win compare to the expenditure of Biden's committee on those states. There is such a trend in the election result this year, but to answer whether there is truly a correlation between expenditure and the voting results would need further investigations on more data sets from previous years.
