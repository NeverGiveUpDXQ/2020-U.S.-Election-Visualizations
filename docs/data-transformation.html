<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data transformation | 2020 U.S. Presidential Election Exploration</title>
  <meta name="description" content="Chapter 3 Data transformation | 2020 U.S. Presidential Election Exploration" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data transformation | 2020 U.S. Presidential Election Exploration" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data transformation | 2020 U.S. Presidential Election Exploration" />
  
  
  

<meta name="author" content="GROUP 10: Jin Qian, Wenjie Zhu, Yibai Liu" />


<meta name="date" content="2020-12-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-sources.html"/>
<link rel="next" href="missing-values.html"/>
<script src="libs/jquery-3.5.0/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<script src="libs/proj4js-2.3.15/proj4.js"></script>
<link href="libs/highcharts-8.1.2/css/motion.css" rel="stylesheet" />
<script src="libs/highcharts-8.1.2/highcharts.js"></script>
<script src="libs/highcharts-8.1.2/highcharts-3d.js"></script>
<script src="libs/highcharts-8.1.2/highcharts-more.js"></script>
<script src="libs/highcharts-8.1.2/modules/stock.js"></script>
<script src="libs/highcharts-8.1.2/modules/map.js"></script>
<script src="libs/highcharts-8.1.2/modules/annotations.js"></script>
<script src="libs/highcharts-8.1.2/modules/data.js"></script>
<script src="libs/highcharts-8.1.2/modules/drilldown.js"></script>
<script src="libs/highcharts-8.1.2/modules/item-series.js"></script>
<script src="libs/highcharts-8.1.2/modules/offline-exporting.js"></script>
<script src="libs/highcharts-8.1.2/modules/overlapping-datalabels.js"></script>
<script src="libs/highcharts-8.1.2/modules/exporting.js"></script>
<script src="libs/highcharts-8.1.2/modules/export-data.js"></script>
<script src="libs/highcharts-8.1.2/modules/funnel.js"></script>
<script src="libs/highcharts-8.1.2/modules/heatmap.js"></script>
<script src="libs/highcharts-8.1.2/modules/treemap.js"></script>
<script src="libs/highcharts-8.1.2/modules/sankey.js"></script>
<script src="libs/highcharts-8.1.2/modules/dependency-wheel.js"></script>
<script src="libs/highcharts-8.1.2/modules/organization.js"></script>
<script src="libs/highcharts-8.1.2/modules/solid-gauge.js"></script>
<script src="libs/highcharts-8.1.2/modules/streamgraph.js"></script>
<script src="libs/highcharts-8.1.2/modules/sunburst.js"></script>
<script src="libs/highcharts-8.1.2/modules/vector.js"></script>
<script src="libs/highcharts-8.1.2/modules/wordcloud.js"></script>
<script src="libs/highcharts-8.1.2/modules/xrange.js"></script>
<script src="libs/highcharts-8.1.2/modules/tilemap.js"></script>
<script src="libs/highcharts-8.1.2/modules/venn.js"></script>
<script src="libs/highcharts-8.1.2/modules/gantt.js"></script>
<script src="libs/highcharts-8.1.2/modules/timeline.js"></script>
<script src="libs/highcharts-8.1.2/modules/parallel-coordinates.js"></script>
<script src="libs/highcharts-8.1.2/modules/bullet.js"></script>
<script src="libs/highcharts-8.1.2/modules/coloraxis.js"></script>
<script src="libs/highcharts-8.1.2/modules/dumbbell.js"></script>
<script src="libs/highcharts-8.1.2/modules/lollipop.js"></script>
<script src="libs/highcharts-8.1.2/modules/series-label.js"></script>
<script src="libs/highcharts-8.1.2/plugins/motion.js"></script>
<script src="libs/highcharts-8.1.2/custom/reset.js"></script>
<script src="libs/highcharts-8.1.2/modules/boost.js"></script>
<script src="libs/highchart-binding-0.8.2/highchart.js"></script>



<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Election Visualizations</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>2</b> Data sources</a><ul>
<li class="chapter" data-level="2.1" data-path="data-sources.html"><a href="data-sources.html#u.s.-state-level-popular-vote-results-of-2020-presidential-election"><i class="fa fa-check"></i><b>2.1</b> U.S. State Level Popular Vote Results of 2020 Presidential Election</a></li>
<li class="chapter" data-level="2.2" data-path="data-sources.html"><a href="data-sources.html#contribution-receipts"><i class="fa fa-check"></i><b>2.2</b> Contribution Receipts</a></li>
<li class="chapter" data-level="2.3" data-path="data-sources.html"><a href="data-sources.html#the-disbursements-data"><i class="fa fa-check"></i><b>2.3</b> The Disbursements data</a></li>
<li class="chapter" data-level="2.4" data-path="data-sources.html"><a href="data-sources.html#other-minor-datasets-used"><i class="fa fa-check"></i><b>2.4</b> Other Minor Datasets Used</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data transformation</a><ul>
<li class="chapter" data-level="3.1" data-path="data-transformation.html"><a href="data-transformation.html#election-result-data-transformation"><i class="fa fa-check"></i><b>3.1</b> Election Result Data Transformation</a></li>
<li class="chapter" data-level="3.2" data-path="data-transformation.html"><a href="data-transformation.html#contribution-data-transformation"><i class="fa fa-check"></i><b>3.2</b> Contribution Data Transformation</a></li>
<li class="chapter" data-level="3.3" data-path="data-transformation.html"><a href="data-transformation.html#disbursement-data-transformation"><i class="fa fa-check"></i><b>3.3</b> Disbursement Data Transformation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>4</b> Missing values</a><ul>
<li class="chapter" data-level="4.1" data-path="missing-values.html"><a href="missing-values.html#contribution-receipt-dataset"><i class="fa fa-check"></i><b>4.1</b> Contribution Receipt Dataset</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a><ul>
<li class="chapter" data-level="5.1" data-path="results.html"><a href="results.html#us-presidential-election"><i class="fa fa-check"></i><b>5.1</b> US Presidential Election</a><ul>
<li class="chapter" data-level="5.1.1" data-path="results.html"><a href="results.html#election-margins-by-state"><i class="fa fa-check"></i><b>5.1.1</b> 2020 Election Margins by State</a></li>
<li class="chapter" data-level="5.1.2" data-path="results.html"><a href="results.html#historical-timeline"><i class="fa fa-check"></i><b>5.1.2</b> Historical Timeline</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="results.html"><a href="results.html#contribution-receipts-data"><i class="fa fa-check"></i><b>5.2</b> Contribution Receipts Data</a><ul>
<li class="chapter" data-level="5.2.1" data-path="results.html"><a href="results.html#where-contributions-came-from"><i class="fa fa-check"></i><b>5.2.1</b> Where Contributions Came from</a></li>
<li class="chapter" data-level="5.2.2" data-path="results.html"><a href="results.html#individual-contribution-distribution"><i class="fa fa-check"></i><b>5.2.2</b> Individual Contribution Distribution</a></li>
<li class="chapter" data-level="5.2.3" data-path="results.html"><a href="results.html#when-contributions-were-made"><i class="fa fa-check"></i><b>5.2.3</b> When Contributions Were Made</a></li>
<li class="chapter" data-level="5.2.4" data-path="results.html"><a href="results.html#who-contributors-were"><i class="fa fa-check"></i><b>5.2.4</b> Who Contributors Were</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="results.html"><a href="results.html#disbursement-data-analysis"><i class="fa fa-check"></i><b>5.3</b> Disbursement Data Analysis</a><ul>
<li class="chapter" data-level="5.3.1" data-path="results.html"><a href="results.html#who-spent-the-most"><i class="fa fa-check"></i><b>5.3.1</b> Who Spent the Most</a></li>
<li class="chapter" data-level="5.3.2" data-path="results.html"><a href="results.html#what-they-spent-money-for"><i class="fa fa-check"></i><b>5.3.2</b> What They Spent Money for</a></li>
<li class="chapter" data-level="5.3.3" data-path="results.html"><a href="results.html#biden-vs.-trump-disbursement-distribution"><i class="fa fa-check"></i><b>5.3.3</b> Biden vs. Trump: Disbursement Distribution</a></li>
<li class="chapter" data-level="5.3.4" data-path="results.html"><a href="results.html#biden-vs.-trump-when-they-spent-the-most"><i class="fa fa-check"></i><b>5.3.4</b> Biden vs. Trump: When they spent the most</a></li>
<li class="chapter" data-level="5.3.5" data-path="results.html"><a href="results.html#biden-vs.-trump-disbursements-by-state"><i class="fa fa-check"></i><b>5.3.5</b> Biden vs. Trump: Disbursements by State</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>6</b> Interactive component</a><ul>
<li class="chapter" data-level="6.1" data-path="interactive-component.html"><a href="interactive-component.html#link-to-the-interactive-map"><i class="fa fa-check"></i><b>6.1</b> Link to the interactive map</a></li>
<li class="chapter" data-level="6.2" data-path="interactive-component.html"><a href="interactive-component.html#descriptions"><i class="fa fa-check"></i><b>6.2</b> Descriptions</a></li>
<li class="chapter" data-level="6.3" data-path="interactive-component.html"><a href="interactive-component.html#instructions-for-using-the-map"><i class="fa fa-check"></i><b>6.3</b> Instructions for using the map</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">2020 U.S. Presidential Election Exploration</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-transformation" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Data transformation</h1>
<p>Most of our small auxiliary datasets have been pre-processed by data providing authorities, hence, we focused on the pre-processing of the major datasets. Please go to our <a href="https://github.com/NeverGiveUpDXQ/2020-U.S.-Election-Visualizations/blob/main/03-cleaning.Rmd">github repo chapter</a> to see code in detail.</p>
<div id="election-result-data-transformation" class="section level2">
<h2><span class="header-section-number">3.1</span> Election Result Data Transformation</h2>
<p>For the election results data, we cleaned up two raw data: 1976-2016 historical election result and 2020 election popular vote share and vote margin.</p>
<p>First, to compare historical popular vote results for <em>republicans</em> on the state level, we cleaned this dataset in following steps:</p>
<ul>
<li>Select columns we needed. i.e. <code>year</code>, <code>state</code>, <code>party</code> and <code>candidatevotes</code>.</li>
<li>Filter column <code>party</code>. i.e. only contains democrats and republicans.</li>
<li>Add a new column <code>ratio</code>, we define <em>ratio = candidatevotes_xxx/(candidatevotes_democrat+candidatevotes_republican)</em></li>
<li>Filter column <code>party</code>. i.e. only leave republican.</li>
<li>Check duplicates and fix typos</li>
</ul>
<p>We then filtered all outliers which involved 3 states:<strong>Utah</strong>, <strong>District of Columbia</strong> and <strong>Minnesota</strong>. After checking data, we know that Republicans have never won D.C. and popular vote shares have always relatively low. So, it is reasonable. However, the share value of <em>Minnesota</em> for Republicans is abnormal as it is equal to 1. It is impossible that all voters chose one party.</p>
<pre><code>## # A tibble: 27 x 4
##     year state                ratio party     
##    &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;     
##  1  1976 District of Columbia 0.832 democrat  
##  2  1976 District of Columbia 0.168 republican
##  3  1980 District of Columbia 0.848 democrat  
##  4  1980 District of Columbia 0.152 republican
##  5  1980 Utah                 0.780 republican
##  6  1980 Utah                 0.220 democrat  
##  7  1984 District of Columbia 0.862 democrat  
##  8  1984 District of Columbia 0.138 republican
##  9  1988 District of Columbia 0.852 democrat  
## 10  1988 District of Columbia 0.148 republican
## # … with 17 more rows</code></pre>
<p>Going back to the raw data, we noticed that in those years, party name for Dem. is <em>democratic-farmer-labor</em> rather than <em>democrat</em>.</p>
<pre><code>## # A tibble: 30 x 3
##     year party                   candidatevotes
##    &lt;dbl&gt; &lt;chr&gt;                            &lt;dbl&gt;
##  1  2000 democratic-farmer-labor        1168266
##  2  2000 republican                     1109659
##  3  2000 green                           126696
##  4  2000 reform party minnesota           22166
##  5  2000 libertarian                       5282
##  6  2000 constitution party                3272
##  7  2000 reform party                      2294
##  8  2000 socialist workers                 1022
##  9  2000 &lt;NA&gt;                                28
## 10  2004 democratic-farmer-labor        1445014
## # … with 20 more rows</code></pre>
<p>After cleaning, it contains 3 columns and 561 records.</p>
<table>
<colgroup>
<col width="19%" />
<col width="80%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Column</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">year</td>
<td align="left">Which election year?</td>
</tr>
<tr class="even">
<td align="left">state</td>
<td align="left">State name</td>
</tr>
<tr class="odd">
<td align="left">dem_this_margin</td>
<td align="left">candidate votes for democrat(%) - candidate votes for republican(%)</td>
</tr>
</tbody>
</table>
<p>Then, we used historical U.S. presidential election data provided in the <code>socviz</code> library, but since the data for 2016 was provisional, we updated the <a href="https://en.wikipedia.org/wiki/2016_United_States_presidential_election">2016 data</a> and also added the 2020 election data for our analysis.</p>
<p>Next, we cleaned up the U.S. State Level Popular Vote Results of 2020 Presidential Election in following steps:</p>
<ul>
<li>Select columns we need. i.e. <code>stateid</code>, <code>state</code>, <code>dem_this_margin</code>, <code>dem_votes</code>, <code>rep_votes</code>.</li>
<li>Add a new column <code>class</code> to indicate if it is <code>States that flipped from 2016</code>, <code>Democrats won</code>, or <code>Republicans won</code>. We define a state as <code>States that flipped from 2016</code> if it is one of <strong>Arizona</strong>, <strong>Wisconsin</strong>, <strong>Michigan</strong>, <strong>Pennsylvania</strong>, <strong>Georgia</strong>. Otherwise, we compared their votes for Democrats and votes for Republicans to determine their class.</li>
</ul>
</div>
<div id="contribution-data-transformation" class="section level2">
<h2><span class="header-section-number">3.2</span> Contribution Data Transformation</h2>
<p>For the contributions receipt dataset, we extracted only relevant columns as described in Data Sources Chapter. We changed the data types for several columns to factorize categorical variables like <code>committee_name</code> and to store <code>contribution_receipt_date</code> in a datetime format for later visualizations. We filtered the <code>contributor_state</code> column to only keep the 50 states of the US plus D.C. and eliminated noise from funds raised from foreign countries. Also, we unified different formats in the <code>contributor_suffix</code> column to eliminate the redundant factor levels. To better scale the contributions, we focused only on individual contributions, thus we applied the <code>entity_type == "IND"</code> to get rid of the contributions from committees, PACs, and organizations.</p>
<p>To save file-reading time and to meet analysis and visualization needs, we made multiple aggregations on different dimensions. We derived a data frame <em>contribution_by_date</em> from aggregating the processed data by <code>contribution_receipt_date</code>, and the sum of <code>contribution_receipt_amount</code> was calculated for this aggregated view. Additionally, we extracted the contributors’ job titles from the column <code>contributor_occupation</code>, cleaned the texts following steps including:</p>
<ul>
<li>Excluded records of uninformational or ineffective strings. For example, we got rid of records equal to “INFORMATION REQUESTED”, “-”, “NA”, “UNKNOWN”, etc.</li>
<li>Gathered column values to a single string separated by blank spaces. We saved some two-word job titles like “SELF EMPLOYED” and “REAL ESTATE” with underlines to avoid them being separated apart.</li>
<li>Inserted spaces to divide words that were sticked together. For example, records like “WRITEREDITORTEACHER” were converted to “WRITER EDITOR TEACHER” with spaces in between.</li>
<li>Split the string to a vector of single words.</li>
<li>Removed unnecessary punctuations and numbers.</li>
<li>Fixed detectable typos and abbreviations</li>
<li>Removed uninformational words stored in the <a href="https://www.rdocumentation.org/packages/tidytext/versions/0.2.6/topics/stop_words">stop words</a> dataset of package <code>tidytext</code>. For example, words like “the”, “of”, and “and” do not add any insight but will distort the frequency distribution.
Finally, the counts for each unique word were calculated and saved in a separate .csv file.</li>
</ul>
</div>
<div id="disbursement-data-transformation" class="section level2">
<h2><span class="header-section-number">3.3</span> Disbursement Data Transformation</h2>
<p>We first extracted the necessary columns that are mentioned in the previous chapter. Then we noticed that in the <code>disbursement_purpose_category</code>, there is a <code>OTHER</code> top coding dominates the dataset, hence it would not provide us lots of interesting information to analyze. Below is the original data distribution for the <code>disbursement_purpose_category</code> column:
<img src="finalproj_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>But since we have another column which is the <code>disbursement_description</code>, we used this information to decode this top code. We examined the frequently mentioned terms in <code>disbursement_description</code> among those marked as <code>OTHER</code> and manually categorize them into existing or new categories that would fit the record type better. Below is a conversion table that we used to convert the columns. The pattern we are looking for in the description ar based on high frequent terms as well as their word stems and abbreviations. The conversion are done based on the order of this list.</p>
<table>
<caption><span id="tab:unnamed-chunk-25">Table 3.1: </span>Disbursement Description to Category Conversion Table</caption>
<colgroup>
<col width="87%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Category Description</th>
<th align="left">New Category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">BANK|PROCESS</td>
<td align="left">BANKING</td>
</tr>
<tr class="even">
<td align="left">CONSULT</td>
<td align="left">CONSULTING</td>
</tr>
<tr class="odd">
<td align="left">SLRY|SALARY|OFFICE|PAYROLL|PYROLL|PHONE|RENT|SOFTWARE|COMPUTER</td>
<td align="left">ADMINISTRATIVE</td>
</tr>
<tr class="even">
<td align="left">MARKET|MARKETING|ADVERTISING</td>
<td align="left">ADVERTISING</td>
</tr>
<tr class="odd">
<td align="left">TRAVEL|TRANSPORT</td>
<td align="left">TRAVEL</td>
</tr>
<tr class="even">
<td align="left">STAG|STAGING|SHIP</td>
<td align="left">MATERIALS</td>
</tr>
<tr class="odd">
<td align="left">EVENT|CATER|UTIL</td>
<td align="left">EVENTS</td>
</tr>
<tr class="even">
<td align="left">CONTRIBUTION</td>
<td align="left">CONTRIBUTIONS</td>
</tr>
<tr class="odd">
<td align="left">REFUND|MILEAGE|REIMBURSE</td>
<td align="left">REFUNDS</td>
</tr>
</tbody>
</table>
<p>Here is the distribution after undo the top coding:
<img src="finalproj_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Now, the top coding category is less significant than before. We perform our further analysis based on this cleaned data set.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-sources.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="missing-values.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/NeverGiveUpDXQ/2020-U.S.-Election-Visualizations/edit/main/03-cleaning.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/NeverGiveUpDXQ/2020-U.S.-Election-Visualizations/blob/main/03-cleaning.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
